<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Cliente - Smart Passes</title>

    <!-- Google Wallet SDK -->
    <script src="https://pay.google.com/gp/p/js/pay.js" async></script>

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
        }
        .header {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header h1 {
            font-size: 28px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .btn-logout {
            background: rgba(255,255,255,0.2);
            border: 2px solid white;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        .btn-logout:hover {
            background: white;
            color: #11998e;
        }
        .container {
            max-width: 1200px;
            margin: 40px auto;
            padding: 0 30px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .stat-card h3 {
            color: #999;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
            text-transform: uppercase;
        }
        .stat-card .number {
            font-size: 36px;
            font-weight: 700;
            color: #11998e;
        }

        /* TABS SYSTEM */
        .tabs-container {
            background: white;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            overflow: hidden;
        }
        .tabs-header {
            display: flex;
            border-bottom: 2px solid #f0f0f0;
            background: #fafafa;
            overflow-x: auto;
        }
        .tab-btn {
            background: none;
            border: none;
            padding: 18px 24px;
            font-size: 15px;
            font-weight: 600;
            color: #666;
            cursor: pointer;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .tab-btn:hover {
            background: #f5f5f5;
            color: #11998e;
        }
        .tab-btn.active {
            color: #11998e;
            border-bottom-color: #11998e;
            background: white;
        }
        .tab-content {
            display: none;
            padding: 30px;
            animation: fadeIn 0.3s;
        }
        .tab-content.active {
            display: block;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* EXISTING STYLES */
        .section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 30px;
        }
        .section h2 {
            font-size: 22px;
            margin-bottom: 20px;
            color: #333;
        }
        .btn-primary {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 20px;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(17, 153, 142, 0.3);
        }
        .api-key-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin-top: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .btn-copy {
            background: #11998e;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
        }
        .btn-copy:hover {
            background: #0d7a6f;
        }
        .clases-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .clase-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .clase-card h3 {
            font-size: 18px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .clase-card .tipo {
            background: rgba(255,255,255,0.2);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        .clase-card .class-id {
            font-family: 'Courier New', monospace;
            font-size: 12px;
            opacity: 0.8;
            margin-top: 10px;
            word-break: break-all;
        }
        .btn-edit-clase {
            background: rgba(255,255,255,0.3);
            border: 1px solid rgba(255,255,255,0.5);
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            margin-top: 12px;
            width: 100%;
            transition: all 0.2s;
        }
        .btn-edit-clase:hover {
            background: rgba(255,255,255,0.4);
            border-color: white;
        }
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }
        .empty-state .icon {
            font-size: 60px;
            margin-bottom: 20px;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        .modal.active {
            display: flex;
        }
        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            max-width: 1100px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
        .modal-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
        }
        @media (max-width: 900px) {
            .modal-grid {
                grid-template-columns: 1fr;
            }
            .preview-container {
                order: -1;
            }
        }
        .preview-container {
            position: sticky;
            top: 0;
        }
        .preview-title {
            font-size: 14px;
            font-weight: 600;
            color: #999;
            text-transform: uppercase;
            margin-bottom: 15px;
            text-align: center;
        }
        .wallet-pass-preview {
            width: 100%;
            max-width: 340px;
            margin: 0 auto;
            background: #fff;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        .pass-header {
            padding: 20px;
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            min-height: 100px;
            background: #4285F4;
            transition: background 0.3s;
        }
        .pass-logo {
            width: 50px;
            height: 50px;
            background: rgba(255,255,255,0.3);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        .pass-logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 8px;
        }
        .pass-issuer {
            flex: 1;
            margin-left: 15px;
            font-weight: 600;
            font-size: 16px;
        }
        .pass-hero {
            width: 100%;
            height: 150px;
            background: rgba(0,0,0,0.05);
            display: none;
            object-fit: cover;
        }
        .pass-hero.visible {
            display: block;
        }
        .pass-body {
            padding: 20px;
            background: white;
        }
        .pass-field {
            margin-bottom: 15px;
        }
        .pass-field-label {
            font-size: 11px;
            color: #999;
            text-transform: uppercase;
            margin-bottom: 3px;
        }
        .pass-field-value {
            font-size: 14px;
            color: #333;
            font-weight: 500;
        }
        .pass-barcode {
            padding: 15px;
            background: #f5f5f5;
            text-align: center;
            border-top: 1px solid #e0e0e0;
        }
        .pass-barcode-placeholder {
            width: 200px;
            height: 200px;
            margin: 0 auto;
            background: white;
            border: 2px dashed #ccc;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 12px;
        }
        .modal h2 {
            margin-bottom: 30px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
        }
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #11998e;
        }
        .form-actions {
            display: flex;
            gap: 10px;
            margin-top: 30px;
        }
        .btn-secondary {
            background: #e0e0e0;
            color: #333;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            flex: 1;
        }
        .btn-secondary:hover {
            background: #d0d0d0;
        }
        .loading {
            display: none;
            text-align: center;
            color: #999;
            margin-top: 20px;
        }
        .success-msg, .error-msg {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }
        .success-msg {
            background: #e8f5e9;
            color: #2e7d32;
        }
        .error-msg {
            background: #ffebee;
            color: #c62828;
        }
        .global-error {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #ffebee;
            color: #c62828;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            display: none;
            z-index: 2000;
            max-width: 400px;
        }

        /* API DOCS STYLES */
        .api-section {
            margin-bottom: 40px;
        }
        .api-section h3 {
            color: #11998e;
            margin-bottom: 15px;
            font-size: 20px;
        }
        .api-section h4 {
            color: #333;
            margin: 20px 0 10px;
            font-size: 16px;
        }
        .endpoint-card {
            background: #f8f9fa;
            border-left: 4px solid #11998e;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }
        .endpoint-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        .method-badge {
            background: #11998e;
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-weight: 700;
            font-size: 12px;
        }
        .method-badge.patch {
            background: #ff9800;
        }
        .endpoint-url {
            font-family: 'Courier New', monospace;
            font-size: 14px;
            color: #333;
            font-weight: 600;
        }
        .code-block {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.6;
            margin: 15px 0;
        }
        .code-block .comment {
            color: #75715e;
        }
        .code-block .string {
            color: #a6e22e;
        }
        .code-block .number {
            color: #ae81ff;
        }
        .code-block .keyword {
            color: #f92672;
        }
        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
        }
        .info-box strong {
            color: #1976d2;
        }
        /* PASES LIST STYLES */
        .filter-section {
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        .filter-section label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        .filter-section select {
            width: 100%;
            max-width: 400px;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            background: white;
            cursor: pointer;
        }
        .pases-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }
        .pase-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s;
            position: relative;
        }
        .pase-card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-color: #11998e;
        }
        .pase-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }
        .pase-tipo {
            display: inline-block;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
        }
        .pase-tipo.lealtad {
            background: #e3f2fd;
            color: #1976d2;
        }
        .pase-tipo.cupon {
            background: #fff3e0;
            color: #f57c00;
        }
        .pase-tipo.evento {
            background: #f3e5f5;
            color: #7b1fa2;
        }
        .pase-tipo.tarjeta-regalo {
            background: #e8f5e9;
            color: #388e3c;
        }
        .pase-tipo.transporte {
            background: #fce4ec;
            color: #c2185b;
        }
        .pase-tipo.generico {
            background: #f5f5f5;
            color: #616161;
        }
        .pase-info {
            margin: 15px 0;
        }
        .pase-info-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            font-size: 14px;
        }
        .pase-info-row strong {
            color: #666;
            font-weight: 600;
        }
        .pase-info-row span {
            color: #333;
        }
        .pase-clase-tag {
            display: inline-block;
            background: #f0f0f0;
            padding: 4px 10px;
            border-radius: 5px;
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        .pase-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #f0f0f0;
        }
        .btn-wallet {
            flex: 1;
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .btn-wallet:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(17, 153, 142, 0.3);
        }
        .btn-details {
            background: #f5f5f5;
            border: 2px solid #ddd;
            color: #666;
            padding: 12px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn-details:hover {
            background: #e0e0e0;
            border-color: #bbb;
        }
        .pases-stats {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 10px;
            color: white;
        }
        .pases-stat-item {
            flex: 1;
            text-align: center;
        }
        .pases-stat-item .label {
            font-size: 12px;
            opacity: 0.9;
            text-transform: uppercase;
            font-weight: 600;
        }
        .pases-stat-item .value {
            font-size: 28px;
            font-weight: 700;
            margin-top: 5px;
        }

        /* NOTIFICACIONES STYLES */
        .notification-forms {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }
        .notification-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 25px;
            transition: all 0.3s;
        }
        .notification-card:hover {
            border-color: #11998e;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        .notification-card h3 {
            margin: 0 0 10px 0;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .notification-card p {
            color: #666;
            font-size: 14px;
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }
        .form-group select,
        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            transition: all 0.3s;
        }
        .form-group select:focus,
        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #11998e;
        }
        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }
        .btn-send-notification {
            width: 100%;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border: none;
            padding: 14px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .btn-send-notification:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(245, 87, 108, 0.3);
        }
        .btn-send-notification:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        .historial-section {
            background: white;
            border-radius: 12px;
            padding: 25px;
            border: 2px solid #e0e0e0;
        }
        .historial-section h3 {
            margin: 0 0 20px 0;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .historial-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .historial-item {
            background: #f8f9fa;
            border-left: 4px solid #11998e;
            padding: 15px;
            border-radius: 8px;
            transition: all 0.3s;
        }
        .historial-item:hover {
            background: #e9ecef;
        }
        .historial-item.error {
            border-left-color: #dc3545;
        }
        .historial-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 10px;
        }
        .historial-type {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 5px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
        }
        .historial-type.clase {
            background: #e3f2fd;
            color: #1976d2;
        }
        .historial-type.pase {
            background: #f3e5f5;
            color: #7b1fa2;
        }
        .historial-time {
            font-size: 12px;
            color: #999;
        }
        .historial-content {
            font-size: 14px;
            color: #333;
            margin-bottom: 8px;
        }
        .historial-target {
            font-size: 13px;
            color: #666;
            font-family: monospace;
            background: white;
            padding: 6px 10px;
            border-radius: 5px;
            display: inline-block;
        }
        .success-msg {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 12px;
            border-radius: 8px;
            margin-top: 15px;
            display: none;
        }
        .error-msg {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 12px;
            border-radius: 8px;
            margin-top: 15px;
            display: none;
        }
        .char-counter {
            text-align: right;
            font-size: 12px;
            color: #999;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <!-- Mensaje de error global -->
    <div class="global-error" id="globalError"></div>

    <div class="header">
        <div class="header-content">
            <h1><span>üé´</span> <span id="nombreNegocio">Smart Passes</span></h1>
            <button class="btn-logout" onclick="logout()">Cerrar Sesi√≥n</button>
        </div>
    </div>

    <div class="container">
        <!-- Stats Cards -->
        <div class="stats-grid">
            <div class="stat-card">
                <h3>Pases Creados</h3>
                <div class="number" id="totalPases">0</div>
            </div>
            <div class="stat-card">
                <h3>Clases Creadas</h3>
                <div class="number" id="totalClases">0</div>
            </div>
            <div class="stat-card">
                <h3>Pases Activos</h3>
                <div class="number" id="pasesActivos">0</div>
            </div>
        </div>

        <!-- Tabs Container -->
        <div class="tabs-container">
            <div class="tabs-header">
                <button class="tab-btn active" onclick="switchTab('crear-clase')">
                    üé® Crear Nueva Clase
                </button>
                <button class="tab-btn" onclick="switchTab('mis-clases')">
                    üìã Mis Clases
                </button>
                <button class="tab-btn" onclick="switchTab('api')">
                    üîå Integraci√≥n API
                </button>
                <button class="tab-btn" onclick="switchTab('mis-pases')">
                    üë• Mis Pases
                </button>
                <button class="tab-btn" onclick="switchTab('notificaciones')">
                    üîî Notificaciones
                </button>
                <button class="tab-btn" onclick="switchTab('updates')">
                    üîÑ Updates
                </button>
                <button class="tab-btn" onclick="switchTab('webhooks')">
                    üîó Webhooks
                </button>
            </div>

            <!-- TAB: Crear Nueva Clase -->
            <div id="tab-crear-clase" class="tab-content active">
                <h2>Crear Nueva Clase de Google Wallet</h2>
                <p style="color: #666; margin-bottom: 30px;">Las clases son plantillas reutilizables. Una vez creada, puedes generar m√∫ltiples pases usando tu API Key.</p>

                <button class="btn-primary" onclick="openCreateClaseModal()">‚ûï Crear Nueva Clase</button>

                <div class="info-box">
                    <strong>üí° Tip:</strong> Crea diferentes clases para diferentes tipos de pases (lealtad, cupones, eventos, etc.). Cada clase puede tener su propio dise√±o y configuraci√≥n.
                </div>
            </div>

            <!-- TAB: Mis Clases -->
            <div id="tab-mis-clases" class="tab-content">
                <h2>Mis Clases de Google Wallet</h2>

                <div id="clasesContainer" class="clases-grid"></div>
                <div id="emptyState" class="empty-state" style="display: none;">
                    <div class="icon">üì¶</div>
                    <h3>No tienes clases creadas</h3>
                    <p>Crea tu primera clase de Google Wallet para empezar a generar pases</p>
                </div>
            </div>

            <!-- TAB: Integraci√≥n API -->
            <div id="tab-api" class="tab-content">
                <h2>üîå Integraci√≥n API</h2>
                <p style="color: #666; margin-bottom: 30px;">Usa estos endpoints para integrar Smart Passes en tu aplicaci√≥n.</p>

                <!-- API Key Section -->
                <div class="api-section">
                    <h3>üîë Tu API Key</h3>
                    <p style="color: #666; margin-bottom: 15px;">Incluye esta clave en el header <code>Authorization</code> de todas tus peticiones.</p>
                    <div class="api-key-box">
                        <code id="apiKeyDisplay2">‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢</code>
                        <button class="btn-copy" onclick="copyApiKey()">Copiar</button>
                    </div>
                </div>

                <!-- Endpoint 1: Crear Pase -->
                <div class="api-section">
                    <h3>1Ô∏è‚É£ Crear Pase Individual</h3>

                    <div class="endpoint-card">
                        <div class="endpoint-header">
                            <span class="method-badge">POST</span>
                            <span class="endpoint-url">/api/crear-pase</span>
                        </div>

                        <p><strong>Descripci√≥n:</strong> Crea un pase individual en Google Wallet y retorna el link para agregarlo.</p>

                        <h4>üì• Request</h4>
                        <div class="code-block">curl -X POST https://smart-passes-api.smartpasses.workers.dev/api/crear-pase \
  -H "Authorization: Bearer TU_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "class_id": "3388000000022737801.smartpasses-123-tarjeta-lealtad",
    "datos": {
      "nombre": "Juan P√©rez",
      "puntos": 1500,
      "account_id": "MEMBER-00123",
      "barcode": {
        "type": "QR_CODE",
        "value": "MEMBER-00123"
      }
    }
  }'</div>

                        <h4>üì§ Response</h4>
                        <div class="code-block">{
  "success": true,
  "objeto_id": "3388000000022737801.smartpasses-123-tarjeta-lealtad-a1b2c3d4",
  "link": "https://pay.google.com/gp/v/save/eyJh..."
}</div>

                        <h4>üîß Ejemplo JavaScript</h4>
                        <div class="code-block">const response = await fetch('https://smart-passes-api.smartpasses.workers.dev/api/crear-pase', {
  method: 'POST',
  headers: {
    'Authorization': 'Bearer TU_API_KEY',
    'Content-Type': 'application/json'
  },
  body: JSON.stringify({
    class_id: '3388000000022737801.smartpasses-123-tarjeta-lealtad',
    datos: {
      nombre: 'Juan P√©rez',
      puntos: 1500,
      account_id: 'MEMBER-00123',
      barcode: {
        type: 'QR_CODE',
        value: 'MEMBER-00123'
      }
    }
  })
});

const data = await response.json();
console.log(data.link); // Link para agregar a Google Wallet</div>
                    </div>
                </div>

                <!-- Endpoint 2: Actualizar Pase -->
                <div class="api-section">
                    <h3>2Ô∏è‚É£ Actualizar Pase Existente</h3>

                    <div class="endpoint-card">
                        <div class="endpoint-header">
                            <span class="method-badge patch">POST</span>
                            <span class="endpoint-url">/api/actualizar-pase</span>
                        </div>

                        <p><strong>Descripci√≥n:</strong> Actualiza campos de un pase existente. Google Wallet enviar√° notificaci√≥n autom√°tica si hay cambios importantes.</p>

                        <h4>üì• Request</h4>
                        <div class="code-block">curl -X POST https://smart-passes-api.smartpasses.workers.dev/api/actualizar-pase \
  -H "Authorization: Bearer TU_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "objeto_id": "3388000000022737801.smartpasses-123-tarjeta-lealtad-a1b2c3d4",
    "datos_actualizados": {
      "puntos": 2000
    }
  }'</div>

                        <h4>üì§ Response</h4>
                        <div class="code-block">{
  "success": true,
  "mensaje": "Pase actualizado. Google Wallet enviar√° notificaci√≥n autom√°tica si hubo cambios importantes."
}</div>
                    </div>
                </div>

                <!-- Endpoint 3: Notificaci√≥n Individual -->
                <div class="api-section">
                    <h3>3Ô∏è‚É£ Enviar Notificaci√≥n a UN Pase</h3>

                    <div class="endpoint-card">
                        <div class="endpoint-header">
                            <span class="method-badge">POST</span>
                            <span class="endpoint-url">/api/notificar-pase</span>
                        </div>

                        <p><strong>Descripci√≥n:</strong> Env√≠a una notificaci√≥n push a un pase espec√≠fico. Aparece en la bandeja de notificaciones del tel√©fono.</p>

                        <h4>üì• Request</h4>
                        <div class="code-block">curl -X POST https://smart-passes-api.smartpasses.workers.dev/api/notificar-pase \
  -H "Authorization: Bearer TU_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "objeto_id": "3388000000022737801.smartpasses-123-tarjeta-lealtad-a1b2c3d4",
    "mensaje": {
      "header": "¬°Promoci√≥n Especial!",
      "body": "Doble puntos en todas tus compras este fin de semana"
    }
  }'</div>

                        <h4>üì§ Response</h4>
                        <div class="code-block">{
  "success": true,
  "mensaje": "Notificaci√≥n enviada"
}</div>
                    </div>
                </div>

                <!-- Endpoint 4: Notificaci√≥n Masiva -->
                <div class="api-section">
                    <h3>4Ô∏è‚É£ Enviar Notificaci√≥n Masiva (Toda una Clase)</h3>

                    <div class="endpoint-card">
                        <div class="endpoint-header">
                            <span class="method-badge">POST</span>
                            <span class="endpoint-url">/api/notificar-clase</span>
                        </div>

                        <p><strong>Descripci√≥n:</strong> Env√≠a una notificaci√≥n push a TODOS los pases de una clase. Perfecto para campa√±as masivas.</p>

                        <h4>üì• Request</h4>
                        <div class="code-block">curl -X POST https://smart-passes-api.smartpasses.workers.dev/api/notificar-clase \
  -H "Authorization: Bearer TU_API_KEY" \
  -H "Content-Type: application/json" \
  -d '{
    "class_id": "3388000000022737801.smartpasses-123-tarjeta-lealtad",
    "mensaje": {
      "header": "Actualizaci√≥n Importante",
      "body": "Nuevos beneficios disponibles para todos los miembros"
    }
  }'</div>

                        <h4>üì§ Response</h4>
                        <div class="code-block">{
  "success": true,
  "mensaje": "Notificaci√≥n enviada a todos los pases de la clase"
}</div>
                    </div>
                </div>

                <!-- Authentication Info -->
                <div class="api-section">
                    <h3>üîê Autenticaci√≥n</h3>
                    <div class="info-box">
                        <strong>Importante:</strong> Todas las peticiones requieren tu API Key en el header <code>Authorization</code>:
                        <div class="code-block" style="margin-top: 10px;">Authorization: Bearer TU_API_KEY</div>
                    </div>
                </div>

                <!-- Error Codes -->
                <div class="api-section">
                    <h3>‚ö†Ô∏è C√≥digos de Error</h3>
                    <table style="width: 100%; border-collapse: collapse; background: white;">
                        <tr style="background: #f5f5f5;">
                            <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">C√≥digo</th>
                            <th style="padding: 12px; text-align: left; border: 1px solid #ddd;">Descripci√≥n</th>
                        </tr>
                        <tr>
                            <td style="padding: 12px; border: 1px solid #ddd;"><code>401</code></td>
                            <td style="padding: 12px; border: 1px solid #ddd;">API key inv√°lida o no proporcionada</td>
                        </tr>
                        <tr>
                            <td style="padding: 12px; border: 1px solid #ddd;"><code>404</code></td>
                            <td style="padding: 12px; border: 1px solid #ddd;">Clase o pase no encontrado</td>
                        </tr>
                        <tr>
                            <td style="padding: 12px; border: 1px solid #ddd;"><code>500</code></td>
                            <td style="padding: 12px; border: 1px solid #ddd;">Error del servidor o error de Google Wallet API</td>
                        </tr>
                    </table>
                </div>
            </div>

            <!-- TAB: Mis Pases -->
            <div id="tab-mis-pases" class="tab-content">
                <h2>üë• Mis Pases Creados</h2>
                <p style="color: #666; margin-bottom: 25px;">Todos los pases individuales que has creado para tus usuarios.</p>

                <!-- Estad√≠sticas de Pases -->
                <div class="pases-stats" id="pasesStats">
                    <div class="pases-stat-item">
                        <div class="label">Total Pases</div>
                        <div class="value" id="totalPasesCount">0</div>
                    </div>
                    <div class="pases-stat-item">
                        <div class="label">Clases Activas</div>
                        <div class="value" id="clasesActivasCount">0</div>
                    </div>
                    <div class="pases-stat-item">
                        <div class="label">√öltimo Creado</div>
                        <div class="value" id="ultimoPaseDate" style="font-size: 16px;">-</div>
                    </div>
                </div>

                <!-- Filtro por Clase -->
                <div class="filter-section">
                    <label for="filtroClase">üîç Filtrar por Clase</label>
                    <select id="filtroClase" onchange="filterPasesByClase()">
                        <option value="">Todas las clases</option>
                    </select>
                </div>

                <!-- Grid de Pases -->
                <div id="pasesContainer" class="pases-grid"></div>

                <!-- Empty State -->
                <div id="emptyStatePases" class="empty-state" style="display: none;">
                    <div class="icon">üì≠</div>
                    <h3>No hay pases creados</h3>
                    <p>Los pases que crees mediante la API aparecer√°n aqu√≠</p>
                </div>
            </div>

            <!-- TAB: Notificaciones -->
            <div id="tab-notificaciones" class="tab-content">
                <h2>üîî Notificaciones Push</h2>
                <p style="color: #666; margin-bottom: 30px;">Env√≠a notificaciones push a los dispositivos de tus usuarios con Google Wallet.</p>

                <!-- Formularios de Notificaci√≥n -->
                <div class="notification-forms">
                    <!-- Notificar Clase Completa -->
                    <div class="notification-card">
                        <h3>
                            <span>üì¢</span>
                            <span>Notificar Clase Completa</span>
                        </h3>
                        <p>Env√≠a una notificaci√≥n a todos los pases de una clase espec√≠fica</p>

                        <form id="formNotificarClase" onsubmit="enviarNotificacionClase(event)">
                            <div class="form-group">
                                <label for="notifClaseSelect">Seleccionar Clase</label>
                                <select id="notifClaseSelect" required>
                                    <option value="">-- Selecciona una clase --</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="notifClaseMensaje">Mensaje</label>
                                <textarea
                                    id="notifClaseMensaje"
                                    placeholder="Escribe el mensaje que se enviar√° a todos los usuarios..."
                                    required
                                    maxlength="200"
                                    oninput="updateCharCounter('notifClaseMensaje', 'charCounterClase')"
                                ></textarea>
                                <div class="char-counter">
                                    <span id="charCounterClase">0</span>/200 caracteres
                                </div>
                            </div>

                            <button type="submit" class="btn-send-notification">
                                <span>üì§</span>
                                <span>Enviar a Toda la Clase</span>
                            </button>

                            <div class="success-msg" id="successMsgClase"></div>
                            <div class="error-msg" id="errorMsgClase"></div>
                        </form>
                    </div>

                    <!-- Notificar Pase Individual -->
                    <div class="notification-card">
                        <h3>
                            <span>üë§</span>
                            <span>Notificar Pase Individual</span>
                        </h3>
                        <p>Env√≠a una notificaci√≥n a un pase espec√≠fico</p>

                        <form id="formNotificarPase" onsubmit="enviarNotificacionPase(event)">
                            <div class="form-group">
                                <label for="notifPaseClaseSelect">Clase</label>
                                <select id="notifPaseClaseSelect" onchange="cargarPasesDeClase()" required>
                                    <option value="">-- Selecciona una clase --</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="notifPaseSelect">Seleccionar Pase</label>
                                <select id="notifPaseSelect" required disabled>
                                    <option value="">-- Primero selecciona una clase --</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="notifPaseMensaje">Mensaje</label>
                                <textarea
                                    id="notifPaseMensaje"
                                    placeholder="Escribe el mensaje que se enviar√° al usuario..."
                                    required
                                    maxlength="200"
                                    oninput="updateCharCounter('notifPaseMensaje', 'charCounterPase')"
                                ></textarea>
                                <div class="char-counter">
                                    <span id="charCounterPase">0</span>/200 caracteres
                                </div>
                            </div>

                            <button type="submit" class="btn-send-notification">
                                <span>üì§</span>
                                <span>Enviar al Pase</span>
                            </button>

                            <div class="success-msg" id="successMsgPase"></div>
                            <div class="error-msg" id="errorMsgPase"></div>
                        </form>
                    </div>
                </div>

                <!-- Historial de Notificaciones -->
                <div class="historial-section">
                    <h3>
                        <span>üìã</span>
                        <span>Historial de Notificaciones</span>
                    </h3>

                    <div id="historialNotificaciones" class="historial-list">
                        <div class="empty-state">
                            <div class="icon">üì≠</div>
                            <h3>Sin notificaciones</h3>
                            <p>Las notificaciones que env√≠es aparecer√°n aqu√≠</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TAB: Updates -->
            <div id="tab-updates" class="tab-content">
                <h2>üîÑ Actualizar Pases</h2>
                <p style="color: #666; margin-bottom: 30px;">Actualiza la informaci√≥n de tus pases de Google Wallet en tiempo real.</p>

                <!-- Formularios de Actualizaci√≥n -->
                <div class="notification-forms">
                    <!-- Actualizar Pase Individual -->
                    <div class="notification-card">
                        <h3>
                            <span>üìù</span>
                            <span>Actualizar Pase Individual</span>
                        </h3>
                        <p>Actualiza la informaci√≥n de un pase espec√≠fico</p>

                        <form id="formActualizarPase" onsubmit="actualizarPaseIndividual(event)">
                            <div class="form-group">
                                <label for="updateClaseSelect">Clase</label>
                                <select id="updateClaseSelect" onchange="cargarPasesParaUpdate()" required>
                                    <option value="">-- Selecciona una clase --</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="updatePaseSelect">Seleccionar Pase</label>
                                <select id="updatePaseSelect" onchange="mostrarCamposUpdate()" required disabled>
                                    <option value="">-- Primero selecciona una clase --</option>
                                </select>
                            </div>

                            <!-- Campos din√°micos seg√∫n tipo de pase -->
                            <div id="camposUpdateDinamicos"></div>

                            <button type="submit" class="btn-send-notification" disabled id="btnActualizarPase">
                                <span>üíæ</span>
                                <span>Actualizar Pase</span>
                            </button>

                            <div class="success-msg" id="successMsgUpdate"></div>
                            <div class="error-msg" id="errorMsgUpdate"></div>
                        </form>
                    </div>

                    <!-- Actualizar Clase Completa -->
                    <div class="notification-card">
                        <h3>
                            <span>üì¢</span>
                            <span>Actualizar Clase Completa</span>
                        </h3>
                        <p>Actualiza todos los pases de una clase a la vez</p>

                        <form id="formActualizarClase" onsubmit="actualizarClaseCompleta(event)">
                            <div class="form-group">
                                <label for="updateClaseCompletaSelect">Seleccionar Clase</label>
                                <select id="updateClaseCompletaSelect" onchange="mostrarCamposUpdateClase()" required>
                                    <option value="">-- Selecciona una clase --</option>
                                </select>
                            </div>

                            <div class="info-box" style="margin-bottom: 20px;">
                                <strong>‚ö†Ô∏è Importante:</strong> Esta acci√≥n actualizar√° TODOS los pases de la clase seleccionada. Los campos que dejes vac√≠os no se modificar√°n.
                            </div>

                            <!-- Campos din√°micos para actualizaci√≥n masiva -->
                            <div id="camposUpdateClaseDinamicos"></div>

                            <button type="submit" class="btn-send-notification" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);" disabled id="btnActualizarClase">
                                <span>üîÑ</span>
                                <span>Actualizar Todos los Pases</span>
                            </button>

                            <div class="success-msg" id="successMsgUpdateClase"></div>
                            <div class="error-msg" id="errorMsgUpdateClase"></div>
                        </form>
                    </div>
                </div>

                <!-- Historial de Actualizaciones -->
                <div class="historial-section">
                    <h3>
                        <span>üìã</span>
                        <span>Historial de Actualizaciones</span>
                    </h3>

                    <div id="historialUpdates" class="historial-list">
                        <div class="empty-state">
                            <div class="icon">üì≠</div>
                            <h3>Sin actualizaciones</h3>
                            <p>Las actualizaciones que realices aparecer√°n aqu√≠</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TAB: Webhooks -->
            <div id="tab-webhooks" class="tab-content">
                <h2>üîó Webhooks y Eventos</h2>
                <p style="color: #666; margin-bottom: 30px;">Monitorea los eventos de Google Wallet en tiempo real.</p>

                <!-- Estad√≠sticas de Eventos -->
                <div class="pases-stats" id="webhooksStats" style="display: none;">
                    <div class="pases-stat-item">
                        <div class="label">Total Eventos</div>
                        <div class="value" id="totalEventosCount">0</div>
                    </div>
                    <div class="pases-stat-item">
                        <div class="label">Pases Guardados</div>
                        <div class="value" id="eventosSaveCount">0</div>
                    </div>
                    <div class="pases-stat-item">
                        <div class="label">Pases Eliminados</div>
                        <div class="value" id="eventosDeleteCount">0</div>
                    </div>
                </div>

                <!-- Informaci√≥n del Webhook -->
                <div class="notification-card" style="margin-bottom: 30px;">
                    <h3>
                        <span>‚öôÔ∏è</span>
                        <span>Configuraci√≥n del Webhook</span>
                    </h3>
                    <p>Para recibir eventos de Google Wallet, configura esta URL en tu Google Cloud Console:</p>

                    <div class="api-key-box" style="margin: 15px 0;">
                        <code id="webhookUrlDisplay">https://smart-passes-api.smartpasses.workers.dev/webhook/wallet-events</code>
                        <button class="btn-copy" onclick="copyWebhookUrl()">Copiar</button>
                    </div>

                    <div class="info-box" style="margin-top: 20px;">
                        <strong>üìù Tipos de eventos:</strong>
                        <ul style="margin: 10px 0; padding-left: 20px;">
                            <li><strong>save:</strong> Usuario guard√≥ el pase en Google Wallet</li>
                            <li><strong>del:</strong> Usuario elimin√≥ el pase de Google Wallet</li>
                        </ul>
                    </div>
                </div>

                <!-- Lista de Eventos -->
                <div class="historial-section">
                    <h3>
                        <span>üìã</span>
                        <span>Log de Eventos</span>
                        <button onclick="refreshWebhooks()" style="margin-left: auto; padding: 8px 15px; background: #11998e; color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 13px;">
                            üîÑ Actualizar
                        </button>
                    </h3>

                    <div id="eventosContainer" class="historial-list">
                        <div class="empty-state">
                            <div class="icon">üì≠</div>
                            <h3>Sin eventos</h3>
                            <p>Los eventos de Google Wallet aparecer√°n aqu√≠</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Crear Clase -->
    <div class="modal" id="createClaseModal">
        <div class="modal-content">
            <h2>Crear Nueva Clase</h2>

            <div class="success-msg" id="successMsg"></div>
            <div class="error-msg" id="errorMsg"></div>

            <div class="modal-grid">
                <!-- Formulario -->
                <div class="form-container">
                    <form id="createClaseForm">
                        <div class="form-group">
                            <label>Tipo de Pase *</label>
                            <select id="tipoPase" required>
                                <option value="">Selecciona un tipo</option>
                                <option value="generic">üé´ Gen√©rico</option>
                                <option value="loyalty">‚≠ê Lealtad</option>
                                <option value="offer">üéÅ Oferta/Cup√≥n</option>
                                <option value="giftcard">üí≥ Tarjeta de Regalo</option>
                                <option value="eventticket">üéüÔ∏è Boleto de Evento</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Nombre de la Clase *</label>
                            <input type="text" id="nombreClase" placeholder="ej: membresia-gym" required>
                            <small style="color: #999;">Solo letras, n√∫meros y guiones</small>
                        </div>

                        <div class="form-group">
                            <label>Nombre del Emisor *</label>
                            <input type="text" id="issuerName" placeholder="Mi Negocio" required>
                        </div>

                        <div class="form-group">
                            <label>Color de Fondo</label>
                            <input type="color" id="colorFondo" value="#4285F4">
                        </div>

                        <div class="form-group">
                            <label>URL del Logo</label>
                            <input type="url" id="logoUrl" placeholder="https://example.com/logo.png">
                        </div>

                        <div class="form-group">
                            <label>URL Hero Image</label>
                            <input type="url" id="heroUrl" placeholder="https://example.com/hero.jpg">
                        </div>

                        <div class="loading" id="loading">Creando clase en Google Wallet...</div>

                        <div class="form-actions">
                            <button type="button" class="btn-secondary" onclick="closeCreateClaseModal()">Cancelar</button>
                            <button type="submit" class="btn-primary" style="flex: 1;">Crear Clase</button>
                        </div>
                    </form>
                </div>

                <!-- Preview en Tiempo Real -->
                <div class="preview-container">
                    <div class="preview-title">Vista Previa</div>
                    <div class="wallet-pass-preview">
                        <div class="pass-header" id="previewHeader">
                            <div class="pass-logo" id="previewLogo">üé´</div>
                            <div class="pass-issuer" id="previewIssuer">Mi Negocio</div>
                        </div>
                        <img class="pass-hero" id="previewHero" src="" alt="Hero Image">
                        <div class="pass-body">
                            <div class="pass-field">
                                <div class="pass-field-label">TIPO DE PASE</div>
                                <div class="pass-field-value" id="previewTipo">Gen√©rico</div>
                            </div>
                            <div class="pass-field">
                                <div class="pass-field-label">CLASE</div>
                                <div class="pass-field-value" id="previewClase">nombre-clase</div>
                            </div>
                        </div>
                        <div class="pass-barcode">
                            <div class="pass-barcode-placeholder">C√≥digo QR</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'https://smart-passes-api.smartpasses.workers.dev';
        let clienteData = {};
        let clasesData = [];

        // TAB SWITCHING
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });

            // Remove active from all buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // Show selected tab
            document.getElementById('tab-' + tabName).classList.add('active');

            // Activate button
            event.target.classList.add('active');

            // Cargar datos espec√≠ficos del tab
            if (tabName === 'mis-pases') {
                loadPases();
            } else if (tabName === 'notificaciones') {
                loadNotificaciones();
            } else if (tabName === 'updates') {
                loadUpdates();
            } else if (tabName === 'webhooks') {
                loadWebhooks();
            }
        }

        // Funci√≥n para mostrar errores globales
        function showError(mensaje, duracion = 5000) {
            const errorDiv = document.getElementById('globalError');
            errorDiv.textContent = mensaje;
            errorDiv.style.display = 'block';
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, duracion);
        }

        // Verificar sesi√≥n al cargar
        window.addEventListener('DOMContentLoaded', async () => {
            const sessionId = localStorage.getItem('sessionId');
            const userType = localStorage.getItem('userType');

            if (!sessionId || userType !== 'cliente') {
                window.location.href = 'cliente-login.html';
                return;
            }

            await loadDashboard();
        });

        async function loadDashboard() {
            const sessionId = localStorage.getItem('sessionId');

            try {
                const response = await fetch(`${API_URL}/cliente/dashboard`, {
                    headers: {
                        'Authorization': `Bearer ${sessionId}`
                    }
                });

                const data = await response.json();

                if (data.success) {
                    clienteData = data.cliente;
                    clasesData = data.clases;

                    // Actualizar UI - solo elementos que existen
                    const nombreNegocio = document.getElementById('nombreNegocio');
                    if (nombreNegocio) nombreNegocio.textContent = clienteData.nombre_negocio;

                    const apiKeyDisplay2 = document.getElementById('apiKeyDisplay2');
                    if (apiKeyDisplay2) apiKeyDisplay2.textContent = clienteData.api_key;

                    const totalPases = document.getElementById('totalPases');
                    if (totalPases) totalPases.textContent = clienteData.estadisticas.pases_creados;

                    const totalClases = document.getElementById('totalClases');
                    if (totalClases) totalClases.textContent = clienteData.estadisticas.clases_creadas;

                    const pasesActivos = document.getElementById('pasesActivos');
                    if (pasesActivos) pasesActivos.textContent = clienteData.estadisticas.pases_activos;

                    renderClases();
                } else {
                    showError('Error al cargar dashboard');
                    setTimeout(() => {
                        window.location.href = 'cliente-login.html';
                    }, 2000);
                }
            } catch (error) {
                console.error('Error:', error);
                showError('Error de conexi√≥n al servidor');
            }
        }

        function renderClases() {
            const container = document.getElementById('clasesContainer');
            const emptyState = document.getElementById('emptyState');

            if (clasesData.length === 0) {
                container.style.display = 'none';
                emptyState.style.display = 'block';
                return;
            }

            container.style.display = 'grid';
            emptyState.style.display = 'none';

            const tiposIconos = {
                'generic': 'üé´',
                'loyalty': '‚≠ê',
                'offer': 'üéÅ',
                'giftcard': 'üí≥',
                'eventticket': 'üéüÔ∏è'
            };

            container.innerHTML = clasesData.map((clase, index) => `
                <div class="clase-card">
                    <h3>
                        <span>${tiposIconos[clase.tipo] || 'üé´'}</span>
                        <span>${clase.nombre}</span>
                    </h3>
                    <div class="tipo">${clase.tipo.toUpperCase()}</div>
                    <div class="class-id">${clase.id}</div>
                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        <button class="btn-edit-clase" onclick="editarClasePorIndice(${index})" style="flex: 1;">
                            ‚úèÔ∏è Editar
                        </button>
                        <button class="btn-edit-clase" onclick="eliminarClase(${index})" style="flex: 1; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                            üóëÔ∏è Eliminar
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function copyApiKey() {
            const apiKey = clienteData.api_key;
            navigator.clipboard.writeText(apiKey);

            const btn = event.target;
            const originalText = btn.textContent;
            btn.textContent = '‚úì Copiado';
            setTimeout(() => {
                btn.textContent = originalText;
            }, 2000);
        }

        // ==========================================
        // FUNCIONES PARA TAB "MIS PASES"
        // ==========================================

        let pasesData = [];
        let pasesDataFiltered = [];

        async function loadPases() {
            const sessionId = localStorage.getItem('sessionId');
            const classId = new URLSearchParams(window.location.search).get('class_id');

            let url = `${API_URL}/cliente/pases`;
            if (classId) {
                url += `?class_id=${classId}`;
            }

            try {
                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${sessionId}`
                    }
                });

                const data = await response.json();

                if (data.success) {
                    pasesData = data.pases || [];
                    pasesDataFiltered = [...pasesData];

                    updatePasesStats();
                    populateFiltroClase();
                    renderPases();
                } else {
                    console.error('Error al cargar pases:', data.error);
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }

        function updatePasesStats() {
            document.getElementById('totalPasesCount').textContent = pasesData.length;

            const clasesUnicas = new Set(pasesData.map(p => p.class_id)).size;
            document.getElementById('clasesActivasCount').textContent = clasesUnicas;

            if (pasesData.length > 0) {
                const ultimoPase = pasesData[0]; // Ya est√°n ordenados por fecha DESC
                const fecha = new Date(ultimoPase.creado_en);
                document.getElementById('ultimoPaseDate').textContent = fecha.toLocaleDateString('es-ES', {
                    day: '2-digit',
                    month: 'short'
                });
            }
        }

        function populateFiltroClase() {
            const select = document.getElementById('filtroClase');
            const clasesUnicas = [...new Set(pasesData.map(p => ({
                id: p.class_id,
                nombre: p.nombre_clase || p.class_id
            })).map(c => JSON.stringify(c)))].map(c => JSON.parse(c));

            select.innerHTML = '<option value="">Todas las clases</option>';
            clasesUnicas.forEach(clase => {
                const option = document.createElement('option');
                option.value = clase.id;
                option.textContent = clase.nombre;
                select.appendChild(option);
            });
        }

        function filterPasesByClase() {
            const filtro = document.getElementById('filtroClase').value;

            if (filtro === '') {
                pasesDataFiltered = [...pasesData];
            } else {
                pasesDataFiltered = pasesData.filter(p => p.class_id === filtro);
            }

            renderPases();
        }

        function renderPases() {
            const container = document.getElementById('pasesContainer');
            const emptyState = document.getElementById('emptyStatePases');

            if (pasesDataFiltered.length === 0) {
                container.style.display = 'none';
                emptyState.style.display = 'block';
                return;
            }

            container.style.display = 'grid';
            emptyState.style.display = 'none';

            container.innerHTML = pasesDataFiltered.map(pase => {
                const datos = pase.datos || {};
                const tipo = pase.tipo || 'generico';
                const tipoDisplay = {
                    'loyalty': 'Lealtad',
                    'offer': 'Cup√≥n',
                    'eventticket': 'Evento',
                    'giftcard': 'Tarjeta Regalo',
                    'transit': 'Transporte',
                    'generic': 'Gen√©rico'
                };

                // Usar el link firmado que viene del backend
                const walletUrl = pase.link || `https://pay.google.com/gp/v/save/${pase.objeto_id}`;

                return `
                    <div class="pase-card">
                        <div class="pase-header">
                            <span class="pase-tipo ${tipo}">${tipoDisplay[tipo] || 'Gen√©rico'}</span>
                            <span style="font-size: 12px; color: #999;">
                                ${new Date(pase.creado_en).toLocaleDateString('es-ES')}
                            </span>
                        </div>

                        <div class="pase-info">
                            <div class="pase-info-row">
                                <strong>ID Objeto:</strong>
                                <span style="font-size: 11px; font-family: monospace;">${pase.objeto_id.substring(pase.objeto_id.lastIndexOf('.') + 1, pase.objeto_id.lastIndexOf('.') + 15)}...</span>
                            </div>
                            ${datos.cardTitle ? `
                            <div class="pase-info-row">
                                <strong>T√≠tulo:</strong>
                                <span>${datos.cardTitle}</span>
                            </div>
                            ` : ''}
                            ${datos.header ? `
                            <div class="pase-info-row">
                                <strong>Header:</strong>
                                <span>${datos.header}</span>
                            </div>
                            ` : ''}
                            ${datos.accountName ? `
                            <div class="pase-info-row">
                                <strong>Usuario:</strong>
                                <span>${datos.accountName}</span>
                            </div>
                            ` : ''}
                            ${datos.points !== undefined ? `
                            <div class="pase-info-row">
                                <strong>Puntos:</strong>
                                <span>${datos.points} pts</span>
                            </div>
                            ` : ''}
                            ${datos.balance ? `
                            <div class="pase-info-row">
                                <strong>Balance:</strong>
                                <span>$${datos.balance}</span>
                            </div>
                            ` : ''}
                        </div>

                        <div class="pase-clase-tag">
                            üìÅ ${pase.nombre_clase || pase.class_id}
                        </div>

                        <div class="pase-actions">
                            <div id="wallet-button-${pase.id}" class="google-wallet-button-container" style="flex: 1;"></div>
                            <button class="btn-details" onclick="copyWalletLink('${walletUrl}')" style="width: auto; padding: 12px 20px;">
                                üîó Copiar Link
                            </button>
                        </div>
                    </div>
                `;
            }).join('');

            // Initialize Google Wallet buttons after DOM is updated
            setTimeout(() => initializeGoogleWalletButtons(), 100);
        }

        // Initialize Google Wallet buttons for each pass
        function initializeGoogleWalletButtons() {
            if (!window.google || !window.google.payments) {
                console.log('Google Wallet SDK no disponible a√∫n, reintentando...');
                setTimeout(() => initializeGoogleWalletButtons(), 500);
                return;
            }

            pasesDataFiltered.forEach(pase => {
                const containerId = `wallet-button-${pase.id}`;
                const container = document.getElementById(containerId);

                if (!container) return;

                // Usar el link firmado que viene del backend
                const walletUrl = pase.link || `https://pay.google.com/gp/v/save/${pase.objeto_id}`;

                try {
                    // Create Google Wallet button using the official SDK
                    const button = document.createElement('div');
                    button.innerHTML = `
                        <g:savetoandroidpay
                            jwt="${pase.objeto_id}"
                            size="match_parent"
                            theme="light"
                            onsuccess="onGoogleWalletSuccess"
                            onfailure="onGoogleWalletFailure">
                        </g:savetoandroidpay>
                    `;

                    // Alternative: Use a direct link button with Google Wallet styling
                    container.innerHTML = `
                        <a href="${walletUrl}"
                           target="_blank"
                           style="display: flex; align-items: center; justify-content: center;
                                  background: #4285f4; color: white; text-decoration: none;
                                  padding: 12px 20px; border-radius: 8px; font-weight: 600;
                                  transition: all 0.3s ease;"
                           onmouseover="this.style.background='#357ae8'"
                           onmouseout="this.style.background='#4285f4'">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="white" style="margin-right: 8px;">
                                <path d="M21,18V19A2,2 0 0,1 19,21H5C3.89,21 3,20.1 3,19V5A2,2 0 0,1 5,3H19A2,2 0 0,1 21,5V6H12C10.89,6 10,6.9 10,8V16A2,2 0 0,0 12,18M12,16H22V8H12M16,13.5A1.5,1.5 0 0,1 14.5,12A1.5,1.5 0 0,1 16,10.5A1.5,1.5 0 0,1 17.5,12A1.5,1.5 0 0,1 16,13.5Z"/>
                            </svg>
                            Agregar a Wallet
                        </a>
                    `;
                } catch (error) {
                    console.error('Error al crear bot√≥n de Google Wallet:', error);
                    // Fallback to simple button
                    container.innerHTML = `
                        <a href="${walletUrl}" target="_blank" class="btn-wallet-fallback">
                            + Agregar a Google Wallet
                        </a>
                    `;
                }
            });
        }

        // Copy wallet link to clipboard
        function copyWalletLink(url) {
            navigator.clipboard.writeText(url).then(() => {
                // Show success feedback
                event.target.textContent = '‚úì Copiado';
                event.target.style.background = 'linear-gradient(135deg, #11998e 0%, #38ef7d 100%)';

                setTimeout(() => {
                    event.target.innerHTML = 'üîó Copiar Link';
                    event.target.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                }, 2000);
            }).catch(err => {
                console.error('Error al copiar:', err);
                showError('No se pudo copiar el link');
            });
        }

        // ==========================================
        // FUNCIONES PARA TAB "NOTIFICACIONES"
        // ==========================================

        let notificacionesHistorial = [];

        function loadNotificaciones() {
            // Cargar historial de localStorage
            const historialGuardado = localStorage.getItem('notificaciones_historial');
            if (historialGuardado) {
                notificacionesHistorial = JSON.parse(historialGuardado);
                renderHistorialNotificaciones();
            }

            // Poblar selectores de clases
            populateNotificacionesClases();
        }

        function populateNotificacionesClases() {
            const selectClase = document.getElementById('notifClaseSelect');
            const selectPaseClase = document.getElementById('notifPaseClaseSelect');

            selectClase.innerHTML = '<option value="">-- Selecciona una clase --</option>';
            selectPaseClase.innerHTML = '<option value="">-- Selecciona una clase --</option>';

            clasesData.forEach(clase => {
                const optionClase = document.createElement('option');
                optionClase.value = clase.id;
                optionClase.textContent = `${clase.nombre} (${clase.tipo})`;
                selectClase.appendChild(optionClase);

                const optionPaseClase = document.createElement('option');
                optionPaseClase.value = clase.id;
                optionPaseClase.textContent = `${clase.nombre} (${clase.tipo})`;
                selectPaseClase.appendChild(optionPaseClase);
            });
        }

        async function cargarPasesDeClase() {
            const classId = document.getElementById('notifPaseClaseSelect').value;
            const selectPase = document.getElementById('notifPaseSelect');

            if (!classId) {
                selectPase.innerHTML = '<option value="">-- Primero selecciona una clase --</option>';
                selectPase.disabled = true;
                return;
            }

            selectPase.disabled = true;
            selectPase.innerHTML = '<option value="">Cargando pases...</option>';

            const sessionId = localStorage.getItem('sessionId');

            try {
                const response = await fetch(`${API_URL}/cliente/pases?class_id=${classId}`, {
                    headers: {
                        'Authorization': `Bearer ${sessionId}`
                    }
                });

                const data = await response.json();

                if (data.success && data.pases.length > 0) {
                    selectPase.innerHTML = '<option value="">-- Selecciona un pase --</option>';
                    data.pases.forEach(pase => {
                        const option = document.createElement('option');
                        option.value = pase.objeto_id;
                        const datos = pase.datos || {};
                        const label = datos.accountName || datos.cardTitle || datos.header || pase.objeto_id.substring(0, 30);
                        option.textContent = label;
                        selectPase.appendChild(option);
                    });
                    selectPase.disabled = false;
                } else {
                    selectPase.innerHTML = '<option value="">-- No hay pases en esta clase --</option>';
                }
            } catch (error) {
                console.error('Error al cargar pases:', error);
                selectPase.innerHTML = '<option value="">-- Error al cargar pases --</option>';
            }
        }

        async function enviarNotificacionClase(event) {
            event.preventDefault();

            const classId = document.getElementById('notifClaseSelect').value;
            const mensaje = document.getElementById('notifClaseMensaje').value;
            const btn = event.target.querySelector('button[type="submit"]');
            const successMsg = document.getElementById('successMsgClase');
            const errorMsg = document.getElementById('errorMsgClase');

            btn.disabled = true;
            btn.innerHTML = '<span>‚è≥</span><span>Enviando...</span>';
            successMsg.style.display = 'none';
            errorMsg.style.display = 'none';

            try {
                const response = await fetch(`${API_URL}/api/notificar-clase`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${clienteData.api_key}`
                    },
                    body: JSON.stringify({
                        class_id: classId,
                        mensaje: mensaje
                    })
                });

                const data = await response.json();

                if (data.success) {
                    successMsg.textContent = `‚úì Notificaci√≥n enviada exitosamente a toda la clase`;
                    successMsg.style.display = 'block';

                    // Guardar en historial
                    agregarAlHistorial('clase', classId, mensaje, true);

                    // Limpiar formulario
                    document.getElementById('formNotificarClase').reset();
                    document.getElementById('charCounterClase').textContent = '0';
                } else {
                    errorMsg.textContent = `‚úó Error: ${data.error}`;
                    errorMsg.style.display = 'block';

                    agregarAlHistorial('clase', classId, mensaje, false, data.error);
                }
            } catch (error) {
                errorMsg.textContent = `‚úó Error de conexi√≥n: ${error.message}`;
                errorMsg.style.display = 'block';

                agregarAlHistorial('clase', classId, mensaje, false, error.message);
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<span>üì§</span><span>Enviar a Toda la Clase</span>';
            }
        }

        async function enviarNotificacionPase(event) {
            event.preventDefault();

            const objetoId = document.getElementById('notifPaseSelect').value;
            const mensaje = document.getElementById('notifPaseMensaje').value;
            const btn = event.target.querySelector('button[type="submit"]');
            const successMsg = document.getElementById('successMsgPase');
            const errorMsg = document.getElementById('errorMsgPase');

            btn.disabled = true;
            btn.innerHTML = '<span>‚è≥</span><span>Enviando...</span>';
            successMsg.style.display = 'none';
            errorMsg.style.display = 'none';

            try {
                const response = await fetch(`${API_URL}/api/notificar-pase`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${clienteData.api_key}`
                    },
                    body: JSON.stringify({
                        objeto_id: objetoId,
                        mensaje: mensaje
                    })
                });

                const data = await response.json();

                if (data.success) {
                    successMsg.textContent = `‚úì Notificaci√≥n enviada exitosamente al pase`;
                    successMsg.style.display = 'block';

                    agregarAlHistorial('pase', objetoId, mensaje, true);

                    // Limpiar formulario
                    document.getElementById('formNotificarPase').reset();
                    document.getElementById('charCounterPase').textContent = '0';
                    document.getElementById('notifPaseSelect').disabled = true;
                } else {
                    errorMsg.textContent = `‚úó Error: ${data.error}`;
                    errorMsg.style.display = 'block';

                    agregarAlHistorial('pase', objetoId, mensaje, false, data.error);
                }
            } catch (error) {
                errorMsg.textContent = `‚úó Error de conexi√≥n: ${error.message}`;
                errorMsg.style.display = 'block';

                agregarAlHistorial('pase', objetoId, mensaje, false, error.message);
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<span>üì§</span><span>Enviar al Pase</span>';
            }
        }

        function agregarAlHistorial(tipo, target, mensaje, exito, error = null) {
            const notificacion = {
                id: Date.now(),
                tipo: tipo,
                target: target,
                mensaje: mensaje,
                exito: exito,
                error: error,
                timestamp: new Date().toISOString()
            };

            notificacionesHistorial.unshift(notificacion);

            // Guardar en localStorage (√∫ltimas 50)
            if (notificacionesHistorial.length > 50) {
                notificacionesHistorial = notificacionesHistorial.slice(0, 50);
            }

            localStorage.setItem('notificaciones_historial', JSON.stringify(notificacionesHistorial));

            renderHistorialNotificaciones();
        }

        function renderHistorialNotificaciones() {
            const container = document.getElementById('historialNotificaciones');

            if (notificacionesHistorial.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">üì≠</div>
                        <h3>Sin notificaciones</h3>
                        <p>Las notificaciones que env√≠es aparecer√°n aqu√≠</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = notificacionesHistorial.map(notif => {
                const fecha = new Date(notif.timestamp);
                const fechaStr = fecha.toLocaleString('es-ES', {
                    day: '2-digit',
                    month: 'short',
                    hour: '2-digit',
                    minute: '2-digit'
                });

                const targetDisplay = notif.tipo === 'clase'
                    ? `Clase: ${clasesData.find(c => c.id === notif.target)?.nombre || notif.target}`
                    : `Pase: ${notif.target.substring(0, 40)}...`;

                return `
                    <div class="historial-item ${notif.exito ? '' : 'error'}">
                        <div class="historial-header">
                            <span class="historial-type ${notif.tipo}">${notif.tipo}</span>
                            <span class="historial-time">${fechaStr}</span>
                        </div>
                        <div class="historial-content">"${notif.mensaje}"</div>
                        <div class="historial-target">${targetDisplay}</div>
                        ${notif.error ? `<div style="color: #dc3545; font-size: 12px; margin-top: 8px;">‚ùå ${notif.error}</div>` : ''}
                        ${notif.exito ? '<div style="color: #28a745; font-size: 12px; margin-top: 8px;">‚úì Enviado exitosamente</div>' : ''}
                    </div>
                `;
            }).join('');
        }

        function updateCharCounter(textareaId, counterId) {
            const textarea = document.getElementById(textareaId);
            const counter = document.getElementById(counterId);
            counter.textContent = textarea.value.length;
        }

        // ==========================================
        // FUNCIONES PARA TAB "UPDATES"
        // ==========================================

        let updatesHistorial = [];
        let paseSeleccionadoParaUpdate = null;

        function loadUpdates() {
            // Cargar historial de localStorage
            const historialGuardado = localStorage.getItem('updates_historial');
            if (historialGuardado) {
                updatesHistorial = JSON.parse(historialGuardado);
                renderHistorialUpdates();
            }

            // Poblar selectores de clases
            populateUpdatesClases();
        }

        function populateUpdatesClases() {
            const selectClase = document.getElementById('updateClaseSelect');
            const selectClaseCompleta = document.getElementById('updateClaseCompletaSelect');

            selectClase.innerHTML = '<option value="">-- Selecciona una clase --</option>';
            selectClaseCompleta.innerHTML = '<option value="">-- Selecciona una clase --</option>';

            clasesData.forEach(clase => {
                const option = document.createElement('option');
                option.value = clase.id;
                option.dataset.tipo = clase.tipo;
                option.textContent = `${clase.nombre} (${clase.tipo})`;
                selectClase.appendChild(option);

                const option2 = document.createElement('option');
                option2.value = clase.id;
                option2.dataset.tipo = clase.tipo;
                option2.textContent = `${clase.nombre} (${clase.tipo})`;
                selectClaseCompleta.appendChild(option2);
            });
        }

        async function cargarPasesParaUpdate() {
            const select = document.getElementById('updateClaseSelect');
            const classId = select.value;
            const selectPase = document.getElementById('updatePaseSelect');
            const camposDiv = document.getElementById('camposUpdateDinamicos');

            if (!classId) {
                selectPase.innerHTML = '<option value="">-- Primero selecciona una clase --</option>';
                selectPase.disabled = true;
                camposDiv.innerHTML = '';
                document.getElementById('btnActualizarPase').disabled = true;
                return;
            }

            selectPase.disabled = true;
            selectPase.innerHTML = '<option value="">Cargando pases...</option>';

            const sessionId = localStorage.getItem('sessionId');

            try {
                const response = await fetch(`${API_URL}/cliente/pases?class_id=${classId}`, {
                    headers: {
                        'Authorization': `Bearer ${sessionId}`
                    }
                });

                const data = await response.json();

                if (data.success && data.pases.length > 0) {
                    selectPase.innerHTML = '<option value="">-- Selecciona un pase --</option>';
                    data.pases.forEach(pase => {
                        const option = document.createElement('option');
                        option.value = pase.objeto_id;
                        option.dataset.pase = JSON.stringify(pase);
                        const datos = pase.datos || {};
                        const label = datos.accountName || datos.cardTitle || datos.header || pase.objeto_id.substring(0, 30);
                        option.textContent = label;
                        selectPase.appendChild(option);
                    });
                    selectPase.disabled = false;
                } else {
                    selectPase.innerHTML = '<option value="">-- No hay pases en esta clase --</option>';
                }
            } catch (error) {
                console.error('Error al cargar pases:', error);
                selectPase.innerHTML = '<option value="">-- Error al cargar pases --</option>';
            }
        }

        function mostrarCamposUpdate() {
            const selectPase = document.getElementById('updatePaseSelect');
            const camposDiv = document.getElementById('camposUpdateDinamicos');
            const btn = document.getElementById('btnActualizarPase');

            if (!selectPase.value) {
                camposDiv.innerHTML = '';
                btn.disabled = true;
                return;
            }

            const option = selectPase.options[selectPase.selectedIndex];
            paseSeleccionadoParaUpdate = JSON.parse(option.dataset.pase);
            const tipo = paseSeleccionadoParaUpdate.tipo;
            const datosActuales = paseSeleccionadoParaUpdate.datos || {};

            camposDiv.innerHTML = generarCamposUpdatePorTipo(tipo, datosActuales);
            btn.disabled = false;
        }

        function mostrarCamposUpdateClase() {
            const select = document.getElementById('updateClaseCompletaSelect');
            const camposDiv = document.getElementById('camposUpdateClaseDinamicos');
            const btn = document.getElementById('btnActualizarClase');

            if (!select.value) {
                camposDiv.innerHTML = '';
                btn.disabled = true;
                return;
            }

            const option = select.options[select.selectedIndex];
            const tipo = option.dataset.tipo;

            camposDiv.innerHTML = generarCamposUpdatePorTipo(tipo, {}, true);
            btn.disabled = false;
        }

        function generarCamposUpdatePorTipo(tipo, datosActuales, esClase = false) {
            let html = '';

            switch (tipo) {
                case 'loyalty':
                    html = `
                        <div class="form-group">
                            <label>Puntos ${esClase ? '(incrementar/decrementar)' : ''}</label>
                            <input type="number" id="update_points" placeholder="${datosActuales.points !== undefined ? 'Actual: ' + datosActuales.points : 'Ej: 100'}">
                            <small style="color: #666; font-size: 12px;">${esClase ? 'Se sumar√° o restar√° este valor a los puntos actuales' : 'Nuevos puntos totales'}</small>
                        </div>
                        <div class="form-group">
                            <label>Nombre del Usuario</label>
                            <input type="text" id="update_accountName" value="${datosActuales.accountName || ''}" placeholder="Ej: Juan P√©rez">
                        </div>
                        <div class="form-group">
                            <label>Mensaje/Estado</label>
                            <input type="text" id="update_message" value="${datosActuales.message || ''}" placeholder="Ej: Gracias por tu preferencia">
                        </div>
                    `;
                    break;

                case 'offer':
                    html = `
                        <div class="form-group">
                            <label>T√≠tulo del Cup√≥n</label>
                            <input type="text" id="update_header" value="${datosActuales.header || ''}" placeholder="Ej: 20% de descuento">
                        </div>
                        <div class="form-group">
                            <label>Usuario</label>
                            <input type="text" id="update_accountName" value="${datosActuales.accountName || ''}" placeholder="Ej: Juan P√©rez">
                        </div>
                        <div class="form-group">
                            <label>Detalles</label>
                            <textarea id="update_details" placeholder="Ej: V√°lido en todos los productos">${datosActuales.details || ''}</textarea>
                        </div>
                    `;
                    break;

                case 'giftcard':
                    html = `
                        <div class="form-group">
                            <label>Balance ${esClase ? '(incrementar/decrementar)' : ''}</label>
                            <input type="number" step="0.01" id="update_balance" placeholder="${datosActuales.balance ? 'Actual: $' + datosActuales.balance : 'Ej: 100.00'}">
                            <small style="color: #666; font-size: 12px;">${esClase ? 'Se sumar√° o restar√° este valor al balance actual' : 'Nuevo balance total'}</small>
                        </div>
                        <div class="form-group">
                            <label>Nombre del Usuario</label>
                            <input type="text" id="update_cardholderName" value="${datosActuales.cardholderName || ''}" placeholder="Ej: Mar√≠a Garc√≠a">
                        </div>
                        <div class="form-group">
                            <label>Mensaje</label>
                            <input type="text" id="update_message" value="${datosActuales.message || ''}" placeholder="Ej: Gracias por tu compra">
                        </div>
                    `;
                    break;

                case 'eventticket':
                    html = `
                        <div class="form-group">
                            <label>Nombre del Evento</label>
                            <input type="text" id="update_eventName" value="${datosActuales.eventName || ''}" placeholder="Ej: Concierto 2024">
                        </div>
                        <div class="form-group">
                            <label>Fecha/Hora</label>
                            <input type="text" id="update_datetime" value="${datosActuales.datetime || ''}" placeholder="Ej: 15 Dic 2024, 8:00 PM">
                        </div>
                        <div class="form-group">
                            <label>Ubicaci√≥n</label>
                            <input type="text" id="update_venue" value="${datosActuales.venue || ''}" placeholder="Ej: Estadio Nacional">
                        </div>
                        <div class="form-group">
                            <label>Asiento/Secci√≥n</label>
                            <input type="text" id="update_seat" value="${datosActuales.seat || ''}" placeholder="Ej: Secci√≥n A, Fila 5">
                        </div>
                    `;
                    break;

                case 'generic':
                default:
                    html = `
                        <div class="form-group">
                            <label>T√≠tulo</label>
                            <input type="text" id="update_cardTitle" value="${datosActuales.cardTitle || ''}" placeholder="T√≠tulo del pase">
                        </div>
                        <div class="form-group">
                            <label>Subt√≠tulo</label>
                            <input type="text" id="update_subheader" value="${datosActuales.subheader || ''}" placeholder="Subt√≠tulo">
                        </div>
                        <div class="form-group">
                            <label>Texto Principal</label>
                            <input type="text" id="update_header" value="${datosActuales.header || ''}" placeholder="Texto principal">
                        </div>
                    `;
                    break;
            }

            return html;
        }

        async function actualizarPaseIndividual(event) {
            event.preventDefault();

            const objetoId = document.getElementById('updatePaseSelect').value;
            const btn = event.target.querySelector('button[type="submit"]');
            const successMsg = document.getElementById('successMsgUpdate');
            const errorMsg = document.getElementById('errorMsgUpdate');

            // Recolectar datos actualizados
            const datosActualizados = {};
            const inputs = document.querySelectorAll('#camposUpdateDinamicos input, #camposUpdateDinamicos textarea');

            inputs.forEach(input => {
                const key = input.id.replace('update_', '');
                if (input.value.trim()) {
                    if (input.type === 'number') {
                        datosActualizados[key] = parseFloat(input.value);
                    } else {
                        datosActualizados[key] = input.value.trim();
                    }
                }
            });

            if (Object.keys(datosActualizados).length === 0) {
                errorMsg.textContent = '‚úó Debes modificar al menos un campo';
                errorMsg.style.display = 'block';
                return;
            }

            btn.disabled = true;
            btn.innerHTML = '<span>‚è≥</span><span>Actualizando...</span>';
            successMsg.style.display = 'none';
            errorMsg.style.display = 'none';

            try {
                const response = await fetch(`${API_URL}/api/actualizar-pase`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${clienteData.api_key}`
                    },
                    body: JSON.stringify({
                        objeto_id: objetoId,
                        datos_actualizados: datosActualizados
                    })
                });

                const data = await response.json();

                if (data.success) {
                    successMsg.textContent = `‚úì Pase actualizado exitosamente`;
                    successMsg.style.display = 'block';

                    agregarAlHistorialUpdates('pase', objetoId, datosActualizados, true);

                    // Limpiar formulario
                    document.getElementById('formActualizarPase').reset();
                    document.getElementById('camposUpdateDinamicos').innerHTML = '';
                    document.getElementById('updatePaseSelect').disabled = true;
                    document.getElementById('btnActualizarPase').disabled = true;
                } else {
                    errorMsg.textContent = `‚úó Error: ${data.error}`;
                    errorMsg.style.display = 'block';

                    agregarAlHistorialUpdates('pase', objetoId, datosActualizados, false, data.error);
                }
            } catch (error) {
                errorMsg.textContent = `‚úó Error de conexi√≥n: ${error.message}`;
                errorMsg.style.display = 'block';

                agregarAlHistorialUpdates('pase', objetoId, datosActualizados, false, error.message);
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<span>üíæ</span><span>Actualizar Pase</span>';
            }
        }

        async function actualizarClaseCompleta(event) {
            event.preventDefault();

            const classId = document.getElementById('updateClaseCompletaSelect').value;
            const btn = event.target.querySelector('button[type="submit"]');
            const successMsg = document.getElementById('successMsgUpdateClase');
            const errorMsg = document.getElementById('errorMsgUpdateClase');

            // Recolectar datos actualizados
            const datosActualizados = {};
            const inputs = document.querySelectorAll('#camposUpdateClaseDinamicos input, #camposUpdateClaseDinamicos textarea');

            inputs.forEach(input => {
                const key = input.id.replace('update_', '');
                if (input.value.trim()) {
                    if (input.type === 'number') {
                        datosActualizados[key] = parseFloat(input.value);
                    } else {
                        datosActualizados[key] = input.value.trim();
                    }
                }
            });

            if (Object.keys(datosActualizados).length === 0) {
                errorMsg.textContent = '‚úó Debes modificar al menos un campo';
                errorMsg.style.display = 'block';
                return;
            }

            // Confirmar acci√≥n
            if (!confirm(`¬øEst√°s seguro de actualizar TODOS los pases de esta clase?\n\nCampos a actualizar: ${Object.keys(datosActualizados).join(', ')}`)) {
                return;
            }

            btn.disabled = true;
            btn.innerHTML = '<span>‚è≥</span><span>Actualizando...</span>';
            successMsg.style.display = 'none';
            errorMsg.style.display = 'none';

            try {
                // Obtener todos los pases de la clase
                const sessionId = localStorage.getItem('sessionId');
                const response = await fetch(`${API_URL}/cliente/pases?class_id=${classId}`, {
                    headers: {
                        'Authorization': `Bearer ${sessionId}`
                    }
                });

                const pasesData = await response.json();

                if (!pasesData.success || pasesData.pases.length === 0) {
                    errorMsg.textContent = '‚úó No se encontraron pases para actualizar';
                    errorMsg.style.display = 'block';
                    btn.disabled = false;
                    btn.innerHTML = '<span>üîÑ</span><span>Actualizar Todos los Pases</span>';
                    return;
                }

                // Actualizar cada pase
                let exitosos = 0;
                let fallidos = 0;

                for (const pase of pasesData.pases) {
                    try {
                        const updateResponse = await fetch(`${API_URL}/api/actualizar-pase`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'Authorization': `Bearer ${clienteData.api_key}`
                            },
                            body: JSON.stringify({
                                objeto_id: pase.objeto_id,
                                datos_actualizados: datosActualizados
                            })
                        });

                        const updateData = await updateResponse.json();
                        if (updateData.success) {
                            exitosos++;
                        } else {
                            fallidos++;
                        }
                    } catch (err) {
                        fallidos++;
                    }
                }

                if (exitosos > 0) {
                    successMsg.textContent = `‚úì Se actualizaron ${exitosos} pase(s) exitosamente${fallidos > 0 ? `. ${fallidos} fallaron.` : ''}`;
                    successMsg.style.display = 'block';

                    agregarAlHistorialUpdates('clase', classId, datosActualizados, true, null, exitosos);

                    // Limpiar formulario
                    document.getElementById('formActualizarClase').reset();
                    document.getElementById('camposUpdateClaseDinamicos').innerHTML = '';
                    document.getElementById('btnActualizarClase').disabled = true;
                } else {
                    errorMsg.textContent = `‚úó Error: No se pudo actualizar ning√∫n pase`;
                    errorMsg.style.display = 'block';

                    agregarAlHistorialUpdates('clase', classId, datosActualizados, false, 'No se pudo actualizar ning√∫n pase');
                }
            } catch (error) {
                errorMsg.textContent = `‚úó Error de conexi√≥n: ${error.message}`;
                errorMsg.style.display = 'block';

                agregarAlHistorialUpdates('clase', classId, datosActualizados, false, error.message);
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<span>üîÑ</span><span>Actualizar Todos los Pases</span>';
            }
        }

        function agregarAlHistorialUpdates(tipo, target, datos, exito, error = null, cantidad = 1) {
            const update = {
                id: Date.now(),
                tipo: tipo,
                target: target,
                datos: datos,
                exito: exito,
                error: error,
                cantidad: cantidad,
                timestamp: new Date().toISOString()
            };

            updatesHistorial.unshift(update);

            // Guardar en localStorage (√∫ltimas 50)
            if (updatesHistorial.length > 50) {
                updatesHistorial = updatesHistorial.slice(0, 50);
            }

            localStorage.setItem('updates_historial', JSON.stringify(updatesHistorial));

            renderHistorialUpdates();
        }

        function renderHistorialUpdates() {
            const container = document.getElementById('historialUpdates');

            if (updatesHistorial.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">üì≠</div>
                        <h3>Sin actualizaciones</h3>
                        <p>Las actualizaciones que realices aparecer√°n aqu√≠</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = updatesHistorial.map(update => {
                const fecha = new Date(update.timestamp);
                const fechaStr = fecha.toLocaleString('es-ES', {
                    day: '2-digit',
                    month: 'short',
                    hour: '2-digit',
                    minute: '2-digit'
                });

                const targetDisplay = update.tipo === 'clase'
                    ? `Clase: ${clasesData.find(c => c.id === update.target)?.nombre || update.target} (${update.cantidad} pase${update.cantidad > 1 ? 's' : ''})`
                    : `Pase: ${update.target.substring(0, 40)}...`;

                const camposActualizados = Object.keys(update.datos).map(k =>
                    `${k}: ${update.datos[k]}`
                ).join(', ');

                return `
                    <div class="historial-item ${update.exito ? '' : 'error'}">
                        <div class="historial-header">
                            <span class="historial-type ${update.tipo}">${update.tipo}</span>
                            <span class="historial-time">${fechaStr}</span>
                        </div>
                        <div class="historial-content">${camposActualizados}</div>
                        <div class="historial-target">${targetDisplay}</div>
                        ${update.error ? `<div style="color: #dc3545; font-size: 12px; margin-top: 8px;">‚ùå ${update.error}</div>` : ''}
                        ${update.exito ? '<div style="color: #28a745; font-size: 12px; margin-top: 8px;">‚úì Actualizado exitosamente</div>' : ''}
                    </div>
                `;
            }).join('');
        }

        // ==========================================
        // FUNCIONES PARA TAB "WEBHOOKS"
        // ==========================================

        let eventosData = [];

        async function loadWebhooks() {
            const sessionId = localStorage.getItem('sessionId');

            try {
                const response = await fetch(`${API_URL}/cliente/eventos`, {
                    headers: {
                        'Authorization': `Bearer ${sessionId}`
                    }
                });

                const data = await response.json();

                if (data.success) {
                    eventosData = data.eventos || [];
                    const estadisticas = data.estadisticas || [];

                    updateWebhooksStats(estadisticas);
                    renderWebhooks();
                } else {
                    console.error('Error al cargar webhooks:', data.error);
                }
            } catch (error) {
                console.error('Error:', error);
            }
        }

        function updateWebhooksStats(estadisticas) {
            const statsDiv = document.getElementById('webhooksStats');

            if (eventosData.length === 0) {
                statsDiv.style.display = 'none';
                return;
            }

            statsDiv.style.display = 'flex';

            const totalEventos = eventosData.length;
            const saveCount = estadisticas.find(s => s.tipo === 'save')?.count || 0;
            const deleteCount = estadisticas.find(s => s.tipo === 'del')?.count || 0;

            document.getElementById('totalEventosCount').textContent = totalEventos;
            document.getElementById('eventosSaveCount').textContent = saveCount;
            document.getElementById('eventosDeleteCount').textContent = deleteCount;
        }

        function renderWebhooks() {
            const container = document.getElementById('eventosContainer');

            if (eventosData.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="icon">üì≠</div>
                        <h3>Sin eventos</h3>
                        <p>Los eventos de Google Wallet aparecer√°n aqu√≠</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = eventosData.map(evento => {
                const fecha = new Date(evento.timestamp);
                const fechaStr = fecha.toLocaleString('es-ES', {
                    day: '2-digit',
                    month: 'short',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });

                const tipoDisplay = {
                    'save': 'üíæ Guardado',
                    'del': 'üóëÔ∏è Eliminado',
                    'update': 'üîÑ Actualizado'
                };

                const tipoClase = evento.tipo === 'save' ? 'clase' : 'pase';
                const icono = tipoDisplay[evento.tipo] || evento.tipo;

                return `
                    <div class="historial-item">
                        <div class="historial-header">
                            <span class="historial-type ${tipoClase}">${icono}</span>
                            <span class="historial-time">${fechaStr}</span>
                        </div>
                        <div class="historial-content">
                            <strong>Evento:</strong> ${evento.tipo.toUpperCase()}
                        </div>
                        <div class="historial-target">
                            <strong>Pase:</strong> ${evento.objeto_id ? evento.objeto_id.substring(0, 50) + '...' : 'N/A'}
                        </div>
                        ${evento.class_id ? `<div style="font-size: 12px; color: #666; margin-top: 5px;"><strong>Clase:</strong> ${evento.class_id}</div>` : ''}
                    </div>
                `;
            }).join('');
        }

        async function refreshWebhooks() {
            const btn = event.target;
            const originalHTML = btn.innerHTML;

            btn.disabled = true;
            btn.innerHTML = '‚è≥ Actualizando...';

            await loadWebhooks();

            btn.disabled = false;
            btn.innerHTML = originalHTML;
        }

        function copyWebhookUrl() {
            const url = document.getElementById('webhookUrlDisplay').textContent;
            navigator.clipboard.writeText(url);

            const btn = event.target;
            const originalText = btn.textContent;
            btn.textContent = '‚úì Copiado';
            setTimeout(() => {
                btn.textContent = originalText;
            }, 2000);
        }

        function openCreateClaseModal() {
            const modal = document.getElementById('createClaseModal');
            const form = document.getElementById('createClaseForm');

            modal.classList.add('active');
            form.reset();

            // Resetear modo de edici√≥n
            delete form.dataset.editMode;
            delete form.dataset.classId;

            // Restaurar t√≠tulo original
            document.querySelector('#createClaseModal h2').textContent = 'Crear Nueva Clase';

            // Restaurar texto del bot√≥n
            document.querySelector('#createClaseForm button[type="submit"]').textContent = 'Crear Clase';

            // Habilitar todos los campos
            document.getElementById('tipoPase').disabled = false;
            document.getElementById('nombreClase').disabled = false;

            document.getElementById('successMsg').style.display = 'none';
            document.getElementById('errorMsg').style.display = 'none';
        }

        function closeCreateClaseModal() {
            document.getElementById('createClaseModal').classList.remove('active');
        }

        // ==========================================
        // PREVIEW EN TIEMPO REAL
        // ==========================================

        const tiposInfo = {
            'generic': { icono: 'üé´', nombre: 'Gen√©rico' },
            'loyalty': { icono: '‚≠ê', nombre: 'Programa de Lealtad' },
            'offer': { icono: 'üéÅ', nombre: 'Oferta/Cup√≥n' },
            'giftcard': { icono: 'üí≥', nombre: 'Tarjeta de Regalo' },
            'eventticket': { icono: 'üéüÔ∏è', nombre: 'Boleto de Evento' }
        };

        function updatePreview() {
            const tipo = document.getElementById('tipoPase').value;
            const nombreClase = document.getElementById('nombreClase').value;
            const issuerName = document.getElementById('issuerName').value;
            const colorFondo = document.getElementById('colorFondo').value;
            const logoUrl = document.getElementById('logoUrl').value;
            const heroUrl = document.getElementById('heroUrl').value;

            // Actualizar color de fondo
            const header = document.getElementById('previewHeader');
            header.style.background = colorFondo || '#4285F4';

            // Actualizar logo
            const logo = document.getElementById('previewLogo');
            if (logoUrl && logoUrl.startsWith('http')) {
                logo.innerHTML = `<img src="${logoUrl}" alt="Logo" onerror="this.parentElement.innerHTML='${tiposInfo[tipo]?.icono || 'üé´'}'">`;
            } else {
                logo.innerHTML = tiposInfo[tipo]?.icono || 'üé´';
            }

            // Actualizar nombre del emisor
            const issuer = document.getElementById('previewIssuer');
            issuer.textContent = issuerName || 'Mi Negocio';

            // Actualizar hero image
            const hero = document.getElementById('previewHero');
            if (heroUrl && heroUrl.startsWith('http')) {
                hero.src = heroUrl;
                hero.classList.add('visible');
            } else {
                hero.classList.remove('visible');
            }

            // Actualizar tipo de pase
            const previewTipo = document.getElementById('previewTipo');
            previewTipo.textContent = tiposInfo[tipo]?.nombre || 'Selecciona un tipo';

            // Actualizar nombre de clase (sanitizado en preview)
            const previewClase = document.getElementById('previewClase');
            const sanitizedName = nombreClase
                .toLowerCase()
                .trim()
                .replace(/[^a-z0-9-]/g, '-')
                .replace(/-+/g, '-')
                .replace(/^-|-$/g, '') || 'nombre-clase';
            previewClase.textContent = sanitizedName;
        }

        // Event listeners para actualizar preview en tiempo real
        document.getElementById('tipoPase').addEventListener('change', updatePreview);
        document.getElementById('nombreClase').addEventListener('input', updatePreview);
        document.getElementById('issuerName').addEventListener('input', updatePreview);
        document.getElementById('colorFondo').addEventListener('input', updatePreview);
        document.getElementById('logoUrl').addEventListener('input', updatePreview);
        document.getElementById('heroUrl').addEventListener('input', updatePreview);

        // Actualizar preview al abrir modal
        const originalOpenModal = openCreateClaseModal;
        openCreateClaseModal = function() {
            originalOpenModal();
            setTimeout(updatePreview, 100);
        };

        document.getElementById('createClaseForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const form = e.target;
            const isEditMode = form.dataset.editMode === 'true';
            const sessionId = localStorage.getItem('sessionId');
            const loading = document.getElementById('loading');
            const successMsg = document.getElementById('successMsg');
            const errorMsg = document.getElementById('errorMsg');

            loading.style.display = 'block';
            successMsg.style.display = 'none';
            errorMsg.style.display = 'none';

            const config = {
                issuer_name: document.getElementById('issuerName').value,
                color_fondo: document.getElementById('colorFondo').value,
                logo_url: document.getElementById('logoUrl').value || null,
                hero_url: document.getElementById('heroUrl').value || null,
                webhook_url: `${API_URL}/webhook/wallet-events`
            };

            try {
                let response;

                if (isEditMode) {
                    // Modo edici√≥n
                    const classId = form.dataset.classId;
                    response = await fetch(`${API_URL}/cliente/editar-clase`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${sessionId}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            class_id: classId,
                            nueva_config: config
                        })
                    });
                } else {
                    // Modo crear
                    const datos = {
                        tipo: document.getElementById('tipoPase').value,
                        nombre_clase: document.getElementById('nombreClase').value,
                        config: config
                    };

                    response = await fetch(`${API_URL}/cliente/crear-clase`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${sessionId}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(datos)
                    });
                }

                const data = await response.json();
                loading.style.display = 'none';

                if (data.success) {
                    successMsg.textContent = isEditMode ? '‚úÖ Clase actualizada exitosamente' : '‚úÖ Clase creada exitosamente';
                    successMsg.style.display = 'block';

                    setTimeout(async () => {
                        closeCreateClaseModal();
                        await loadDashboard();
                    }, 1500);
                } else {
                    errorMsg.textContent = data.error || (isEditMode ? 'Error al actualizar clase' : 'Error al crear clase');
                    errorMsg.style.display = 'block';
                }
            } catch (error) {
                loading.style.display = 'none';
                errorMsg.textContent = 'Error de conexi√≥n';
                errorMsg.style.display = 'block';
            }
        });

        function logout() {
            localStorage.clear();
            window.location.href = 'cliente-login.html';
        }

        // ==========================================
        // EDITAR CLASE EXISTENTE
        // ==========================================

        function editarClasePorIndice(index) {
            try {
                const clase = clasesData[index];
                if (!clase) {
                    showError('Clase no encontrada');
                    return;
                }

                const config = typeof clase.config === 'string' ? JSON.parse(clase.config) : clase.config;

                // Llenar formulario con datos existentes
                document.getElementById('tipoPase').value = clase.tipo;
                document.getElementById('nombreClase').value = clase.nombre || '';
                document.getElementById('issuerName').value = config.issuer_name || '';
                document.getElementById('colorFondo').value = config.color_fondo || '#4285F4';
                document.getElementById('logoUrl').value = config.logo_url || '';
                document.getElementById('heroUrl').value = config.hero_url || '';

                // Actualizar preview
                setTimeout(updatePreview, 50);

                // Abrir modal
                openCreateClaseModal();

                // Cambiar t√≠tulo del modal
                document.querySelector('#createClaseModal h2').textContent = 'Editar Clase';

                // Cambiar el comportamiento del submit
                const form = document.getElementById('createClaseForm');
                form.dataset.editMode = 'true';
                form.dataset.classId = clase.id;

                // Cambiar texto del bot√≥n
                document.querySelector('#createClaseForm button[type="submit"]').textContent = 'Guardar Cambios';

                // Deshabilitar campo de tipo (no se puede cambiar al editar)
                document.getElementById('tipoPase').disabled = true;
                document.getElementById('nombreClase').disabled = true;
            } catch (error) {
                console.error('Error al editar clase:', error);
                showError('Error al cargar datos de la clase');
            }
        }

        async function eliminarClase(index) {
            try {
                const clase = clasesData[index];
                if (!clase) {
                    showError('Clase no encontrada');
                    return;
                }

                // Confirmar antes de eliminar
                const confirmacion = confirm(
                    `¬øEst√°s seguro de eliminar la clase "${clase.nombre}"?\n\n` +
                    `Esta acci√≥n no se puede deshacer.\n\n` +
                    `IMPORTANTE: Si la clase tiene pases asociados, no podr√° ser eliminada.`
                );

                if (!confirmacion) {
                    return;
                }

                const sessionId = localStorage.getItem('sessionId');

                const response = await fetch(`${API_URL}/cliente/eliminar-clase`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${sessionId}`
                    },
                    body: JSON.stringify({
                        class_id: clase.id
                    })
                });

                const data = await response.json();

                if (data.success) {
                    // Eliminar de la lista local
                    clasesData.splice(index, 1);

                    // Re-renderizar
                    renderClases();

                    // Mostrar mensaje de √©xito
                    showError('‚úì Clase eliminada exitosamente', 3000);

                    // Actualizar estad√≠sticas
                    const totalClases = document.getElementById('totalClases');
                    if (totalClases) {
                        totalClases.textContent = clasesData.length;
                    }
                } else {
                    showError(data.error || 'Error al eliminar la clase');
                }
            } catch (error) {
                console.error('Error al eliminar clase:', error);
                showError('Error de conexi√≥n al servidor');
            }
        }
    </script>
</body>
</html>
