<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Cliente - Smart Passes</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
        }
        .header {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header h1 {
            font-size: 28px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .btn-logout {
            background: rgba(255,255,255,0.2);
            border: 2px solid white;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        .btn-logout:hover {
            background: white;
            color: #11998e;
        }
        .container {
            max-width: 1200px;
            margin: 40px auto;
            padding: 0 30px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        .stat-card h3 {
            color: #999;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
            text-transform: uppercase;
        }
        .stat-card .number {
            font-size: 36px;
            font-weight: 700;
            color: #11998e;
        }
        .section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 30px;
        }
        .section h2 {
            font-size: 22px;
            margin-bottom: 20px;
            color: #333;
        }
        .btn-primary {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 20px;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(17, 153, 142, 0.3);
        }
        .api-key-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin-top: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .btn-copy {
            background: #11998e;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            font-weight: 600;
        }
        .btn-copy:hover {
            background: #0d7a6f;
        }
        .clases-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .clase-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .clase-card h3 {
            font-size: 18px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .clase-card .tipo {
            background: rgba(255,255,255,0.2);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        .clase-card .class-id {
            font-family: 'Courier New', monospace;
            font-size: 12px;
            opacity: 0.8;
            margin-top: 10px;
            word-break: break-all;
        }
        .btn-edit-clase {
            background: rgba(255,255,255,0.3);
            border: 1px solid rgba(255,255,255,0.5);
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            margin-top: 12px;
            width: 100%;
            transition: all 0.2s;
        }
        .btn-edit-clase:hover {
            background: rgba(255,255,255,0.4);
            border-color: white;
        }
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }
        .empty-state .icon {
            font-size: 60px;
            margin-bottom: 20px;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        .modal.active {
            display: flex;
        }
        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            max-width: 1100px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
        .modal-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
        }
        @media (max-width: 900px) {
            .modal-grid {
                grid-template-columns: 1fr;
            }
            .preview-container {
                order: -1;
            }
        }
        .preview-container {
            position: sticky;
            top: 0;
        }
        .preview-title {
            font-size: 14px;
            font-weight: 600;
            color: #999;
            text-transform: uppercase;
            margin-bottom: 15px;
            text-align: center;
        }
        .wallet-pass-preview {
            width: 100%;
            max-width: 340px;
            margin: 0 auto;
            background: #fff;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            overflow: hidden;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        .pass-header {
            padding: 20px;
            color: white;
            display: flex;
            align-items: center;
            justify-content: space-between;
            min-height: 100px;
            background: #4285F4;
            transition: background 0.3s;
        }
        .pass-logo {
            width: 50px;
            height: 50px;
            background: rgba(255,255,255,0.3);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        .pass-logo img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 8px;
        }
        .pass-issuer {
            flex: 1;
            margin-left: 15px;
            font-weight: 600;
            font-size: 16px;
        }
        .pass-hero {
            width: 100%;
            height: 150px;
            background: rgba(0,0,0,0.05);
            display: none;
            object-fit: cover;
        }
        .pass-hero.visible {
            display: block;
        }
        .pass-body {
            padding: 20px;
            background: white;
        }
        .pass-field {
            margin-bottom: 15px;
        }
        .pass-field-label {
            font-size: 11px;
            color: #999;
            text-transform: uppercase;
            margin-bottom: 3px;
        }
        .pass-field-value {
            font-size: 14px;
            color: #333;
            font-weight: 500;
        }
        .pass-barcode {
            padding: 15px;
            background: #f5f5f5;
            text-align: center;
            border-top: 1px solid #e0e0e0;
        }
        .pass-barcode-placeholder {
            width: 200px;
            height: 200px;
            margin: 0 auto;
            background: white;
            border: 2px dashed #ccc;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #999;
            font-size: 12px;
        }
        .modal h2 {
            margin-bottom: 30px;
        }
        .form-group {
            margin-bottom: 20px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #555;
        }
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
        }
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #11998e;
        }
        .form-actions {
            display: flex;
            gap: 10px;
            margin-top: 30px;
        }
        .btn-secondary {
            background: #e0e0e0;
            color: #333;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            flex: 1;
        }
        .btn-secondary:hover {
            background: #d0d0d0;
        }
        .loading {
            display: none;
            text-align: center;
            color: #999;
            margin-top: 20px;
        }
        .success-msg, .error-msg {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }
        .success-msg {
            background: #e8f5e9;
            color: #2e7d32;
        }
        .error-msg {
            background: #ffebee;
            color: #c62828;
        }
        .global-error {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #ffebee;
            color: #c62828;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            display: none;
            z-index: 2000;
            max-width: 400px;
        }
    </style>
</head>
<body>
    <!-- Mensaje de error global -->
    <div class="global-error" id="globalError"></div>

    <div class="header">
        <div class="header-content">
            <h1><span>üé´</span> <span id="nombreNegocio">Mi Negocio</span></h1>
            <button class="btn-logout" onclick="logout()">Cerrar Sesi√≥n</button>
        </div>
    </div>

    <div class="container">
        <div class="stats-grid">
            <div class="stat-card">
                <h3>Pases Creados</h3>
                <div class="number" id="totalPases">0</div>
            </div>
            <div class="stat-card">
                <h3>Clases Creadas</h3>
                <div class="number" id="totalClases">0</div>
            </div>
            <div class="stat-card">
                <h3>Pases Activos</h3>
                <div class="number" id="pasesActivos">0</div>
            </div>
        </div>

        <div class="section">
            <h2>API Key</h2>
            <p style="color: #666; margin-bottom: 10px;">Usa esta clave para crear pases mediante la API</p>
            <div class="api-key-box">
                <code id="apiKeyDisplay">‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢</code>
                <button class="btn-copy" onclick="copyApiKey()">Copiar</button>
            </div>
        </div>

        <div class="section">
            <h2>Mis Clases de Google Wallet</h2>
            <button class="btn-primary" onclick="openCreateClaseModal()">‚ûï Crear Nueva Clase</button>

            <div id="clasesContainer" class="clases-grid"></div>
            <div id="emptyState" class="empty-state" style="display: none;">
                <div class="icon">üì¶</div>
                <h3>No tienes clases creadas</h3>
                <p>Crea tu primera clase de Google Wallet para empezar a generar pases</p>
            </div>
        </div>
    </div>

    <!-- Modal Crear Clase -->
    <div class="modal" id="createClaseModal">
        <div class="modal-content">
            <h2>Crear Nueva Clase</h2>

            <div class="success-msg" id="successMsg"></div>
            <div class="error-msg" id="errorMsg"></div>

            <div class="modal-grid">
                <!-- Formulario -->
                <div class="form-container">
                    <form id="createClaseForm">
                        <div class="form-group">
                            <label>Tipo de Pase *</label>
                            <select id="tipoPase" required>
                                <option value="">Selecciona un tipo</option>
                                <option value="generic">üé´ Gen√©rico</option>
                                <option value="loyalty">‚≠ê Lealtad</option>
                                <option value="offer">üéÅ Oferta/Cup√≥n</option>
                                <option value="giftcard">üí≥ Tarjeta de Regalo</option>
                                <option value="eventticket">üéüÔ∏è Boleto de Evento</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Nombre de la Clase *</label>
                            <input type="text" id="nombreClase" placeholder="ej: membresia-gym" required>
                            <small style="color: #999;">Solo letras, n√∫meros y guiones</small>
                        </div>

                        <div class="form-group">
                            <label>Nombre del Emisor *</label>
                            <input type="text" id="issuerName" placeholder="Mi Negocio" required>
                        </div>

                        <div class="form-group">
                            <label>Color de Fondo</label>
                            <input type="color" id="colorFondo" value="#4285F4">
                        </div>

                        <div class="form-group">
                            <label>URL del Logo</label>
                            <input type="url" id="logoUrl" placeholder="https://example.com/logo.png">
                        </div>

                        <div class="form-group">
                            <label>URL Hero Image</label>
                            <input type="url" id="heroUrl" placeholder="https://example.com/hero.jpg">
                        </div>

                        <div class="loading" id="loading">Creando clase en Google Wallet...</div>

                        <div class="form-actions">
                            <button type="button" class="btn-secondary" onclick="closeCreateClaseModal()">Cancelar</button>
                            <button type="submit" class="btn-primary" style="flex: 1;">Crear Clase</button>
                        </div>
                    </form>
                </div>

                <!-- Preview en Tiempo Real -->
                <div class="preview-container">
                    <div class="preview-title">Vista Previa</div>
                    <div class="wallet-pass-preview">
                        <div class="pass-header" id="previewHeader">
                            <div class="pass-logo" id="previewLogo">üé´</div>
                            <div class="pass-issuer" id="previewIssuer">Mi Negocio</div>
                        </div>
                        <img class="pass-hero" id="previewHero" src="" alt="Hero Image">
                        <div class="pass-body">
                            <div class="pass-field">
                                <div class="pass-field-label">TIPO DE PASE</div>
                                <div class="pass-field-value" id="previewTipo">Gen√©rico</div>
                            </div>
                            <div class="pass-field">
                                <div class="pass-field-label">CLASE</div>
                                <div class="pass-field-value" id="previewClase">nombre-clase</div>
                            </div>
                        </div>
                        <div class="pass-barcode">
                            <div class="pass-barcode-placeholder">C√≥digo QR</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'https://smart-passes-api.smartpasses.workers.dev';
        let clienteData = {};
        let clasesData = [];

        // Funci√≥n para mostrar errores globales
        function showError(mensaje, duracion = 5000) {
            const errorDiv = document.getElementById('globalError');
            errorDiv.textContent = mensaje;
            errorDiv.style.display = 'block';
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, duracion);
        }

        // Verificar sesi√≥n al cargar
        window.addEventListener('DOMContentLoaded', async () => {
            const sessionId = localStorage.getItem('sessionId');
            const userType = localStorage.getItem('userType');

            if (!sessionId || userType !== 'cliente') {
                window.location.href = 'cliente-login.html';
                return;
            }

            await loadDashboard();
        });

        async function loadDashboard() {
            const sessionId = localStorage.getItem('sessionId');

            try {
                const response = await fetch(`${API_URL}/cliente/dashboard`, {
                    headers: {
                        'Authorization': `Bearer ${sessionId}`
                    }
                });

                const data = await response.json();

                if (data.success) {
                    clienteData = data.cliente;
                    clasesData = data.clases;

                    // Actualizar UI
                    document.getElementById('nombreNegocio').textContent = clienteData.nombre_negocio;
                    document.getElementById('apiKeyDisplay').textContent = clienteData.api_key;
                    document.getElementById('totalPases').textContent = clienteData.estadisticas.pases_creados;
                    document.getElementById('totalClases').textContent = clienteData.estadisticas.clases_creadas;
                    document.getElementById('pasesActivos').textContent = clienteData.estadisticas.pases_activos;

                    renderClases();
                } else {
                    showError('Error al cargar dashboard');
                    setTimeout(() => {
                        window.location.href = 'cliente-login.html';
                    }, 2000);
                }
            } catch (error) {
                console.error('Error:', error);
                showError('Error de conexi√≥n al servidor');
            }
        }

        function renderClases() {
            const container = document.getElementById('clasesContainer');
            const emptyState = document.getElementById('emptyState');

            if (clasesData.length === 0) {
                container.style.display = 'none';
                emptyState.style.display = 'block';
                return;
            }

            container.style.display = 'grid';
            emptyState.style.display = 'none';

            const tiposIconos = {
                'generic': 'üé´',
                'loyalty': '‚≠ê',
                'offer': 'üéÅ',
                'giftcard': 'üí≥',
                'eventticket': 'üéüÔ∏è'
            };

            container.innerHTML = clasesData.map((clase, index) => `
                <div class="clase-card">
                    <h3>
                        <span>${tiposIconos[clase.tipo] || 'üé´'}</span>
                        <span>${clase.nombre}</span>
                    </h3>
                    <div class="tipo">${clase.tipo.toUpperCase()}</div>
                    <div class="class-id">${clase.id}</div>
                    <button class="btn-edit-clase" onclick="editarClasePorIndice(${index})">
                        ‚úèÔ∏è Editar
                    </button>
                </div>
            `).join('');
        }

        function copyApiKey() {
            const apiKey = clienteData.api_key;
            navigator.clipboard.writeText(apiKey);

            const btn = event.target;
            const originalText = btn.textContent;
            btn.textContent = '‚úì Copiado';
            setTimeout(() => {
                btn.textContent = originalText;
            }, 2000);
        }

        function openCreateClaseModal() {
            const modal = document.getElementById('createClaseModal');
            const form = document.getElementById('createClaseForm');

            modal.classList.add('active');
            form.reset();

            // Resetear modo de edici√≥n
            delete form.dataset.editMode;
            delete form.dataset.classId;

            // Restaurar t√≠tulo original
            document.querySelector('#createClaseModal h2').textContent = 'Crear Nueva Clase';

            // Restaurar texto del bot√≥n
            document.querySelector('#createClaseForm button[type="submit"]').textContent = 'Crear Clase';

            // Habilitar todos los campos
            document.getElementById('tipoPase').disabled = false;
            document.getElementById('nombreClase').disabled = false;

            document.getElementById('successMsg').style.display = 'none';
            document.getElementById('errorMsg').style.display = 'none';
        }

        function closeCreateClaseModal() {
            document.getElementById('createClaseModal').classList.remove('active');
        }

        // ==========================================
        // PREVIEW EN TIEMPO REAL
        // ==========================================

        const tiposInfo = {
            'generic': { icono: 'üé´', nombre: 'Gen√©rico' },
            'loyalty': { icono: '‚≠ê', nombre: 'Programa de Lealtad' },
            'offer': { icono: 'üéÅ', nombre: 'Oferta/Cup√≥n' },
            'giftcard': { icono: 'üí≥', nombre: 'Tarjeta de Regalo' },
            'eventticket': { icono: 'üéüÔ∏è', nombre: 'Boleto de Evento' }
        };

        function updatePreview() {
            const tipo = document.getElementById('tipoPase').value;
            const nombreClase = document.getElementById('nombreClase').value;
            const issuerName = document.getElementById('issuerName').value;
            const colorFondo = document.getElementById('colorFondo').value;
            const logoUrl = document.getElementById('logoUrl').value;
            const heroUrl = document.getElementById('heroUrl').value;

            // Actualizar color de fondo
            const header = document.getElementById('previewHeader');
            header.style.background = colorFondo || '#4285F4';

            // Actualizar logo
            const logo = document.getElementById('previewLogo');
            if (logoUrl && logoUrl.startsWith('http')) {
                logo.innerHTML = `<img src="${logoUrl}" alt="Logo" onerror="this.parentElement.innerHTML='${tiposInfo[tipo]?.icono || 'üé´'}'">`;
            } else {
                logo.innerHTML = tiposInfo[tipo]?.icono || 'üé´';
            }

            // Actualizar nombre del emisor
            const issuer = document.getElementById('previewIssuer');
            issuer.textContent = issuerName || 'Mi Negocio';

            // Actualizar hero image
            const hero = document.getElementById('previewHero');
            if (heroUrl && heroUrl.startsWith('http')) {
                hero.src = heroUrl;
                hero.classList.add('visible');
            } else {
                hero.classList.remove('visible');
            }

            // Actualizar tipo de pase
            const previewTipo = document.getElementById('previewTipo');
            previewTipo.textContent = tiposInfo[tipo]?.nombre || 'Selecciona un tipo';

            // Actualizar nombre de clase (sanitizado en preview)
            const previewClase = document.getElementById('previewClase');
            const sanitizedName = nombreClase
                .toLowerCase()
                .trim()
                .replace(/[^a-z0-9-]/g, '-')
                .replace(/-+/g, '-')
                .replace(/^-|-$/g, '') || 'nombre-clase';
            previewClase.textContent = sanitizedName;
        }

        // Event listeners para actualizar preview en tiempo real
        document.getElementById('tipoPase').addEventListener('change', updatePreview);
        document.getElementById('nombreClase').addEventListener('input', updatePreview);
        document.getElementById('issuerName').addEventListener('input', updatePreview);
        document.getElementById('colorFondo').addEventListener('input', updatePreview);
        document.getElementById('logoUrl').addEventListener('input', updatePreview);
        document.getElementById('heroUrl').addEventListener('input', updatePreview);

        // Actualizar preview al abrir modal
        const originalOpenModal = openCreateClaseModal;
        openCreateClaseModal = function() {
            originalOpenModal();
            setTimeout(updatePreview, 100);
        };

        document.getElementById('createClaseForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const form = e.target;
            const isEditMode = form.dataset.editMode === 'true';
            const sessionId = localStorage.getItem('sessionId');
            const loading = document.getElementById('loading');
            const successMsg = document.getElementById('successMsg');
            const errorMsg = document.getElementById('errorMsg');

            loading.style.display = 'block';
            successMsg.style.display = 'none';
            errorMsg.style.display = 'none';

            const config = {
                issuer_name: document.getElementById('issuerName').value,
                color_fondo: document.getElementById('colorFondo').value,
                logo_url: document.getElementById('logoUrl').value || null,
                hero_url: document.getElementById('heroUrl').value || null,
                webhook_url: `${API_URL}/webhook/wallet-events`
            };

            try {
                let response;

                if (isEditMode) {
                    // Modo edici√≥n
                    const classId = form.dataset.classId;
                    response = await fetch(`${API_URL}/cliente/editar-clase`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${sessionId}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            class_id: classId,
                            nueva_config: config
                        })
                    });
                } else {
                    // Modo crear
                    const datos = {
                        tipo: document.getElementById('tipoPase').value,
                        nombre_clase: document.getElementById('nombreClase').value,
                        config: config
                    };

                    response = await fetch(`${API_URL}/cliente/crear-clase`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${sessionId}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(datos)
                    });
                }

                const data = await response.json();
                loading.style.display = 'none';

                if (data.success) {
                    successMsg.textContent = isEditMode ? '‚úÖ Clase actualizada exitosamente' : '‚úÖ Clase creada exitosamente';
                    successMsg.style.display = 'block';

                    setTimeout(async () => {
                        closeCreateClaseModal();
                        await loadDashboard();
                    }, 1500);
                } else {
                    errorMsg.textContent = data.error || (isEditMode ? 'Error al actualizar clase' : 'Error al crear clase');
                    errorMsg.style.display = 'block';
                }
            } catch (error) {
                loading.style.display = 'none';
                errorMsg.textContent = 'Error de conexi√≥n';
                errorMsg.style.display = 'block';
            }
        });

        function logout() {
            localStorage.clear();
            window.location.href = 'cliente-login.html';
        }

        // ==========================================
        // EDITAR CLASE EXISTENTE
        // ==========================================

        function editarClasePorIndice(index) {
            try {
                const clase = clasesData[index];
                if (!clase) {
                    showError('Clase no encontrada');
                    return;
                }

                const config = typeof clase.config === 'string' ? JSON.parse(clase.config) : clase.config;

                // Llenar formulario con datos existentes
                document.getElementById('tipoPase').value = clase.tipo;
                document.getElementById('nombreClase').value = clase.nombre || '';
                document.getElementById('issuerName').value = config.issuer_name || '';
                document.getElementById('colorFondo').value = config.color_fondo || '#4285F4';
                document.getElementById('logoUrl').value = config.logo_url || '';
                document.getElementById('heroUrl').value = config.hero_url || '';

                // Actualizar preview
                setTimeout(updatePreview, 50);

                // Abrir modal
                openCreateClaseModal();

                // Cambiar t√≠tulo del modal
                document.querySelector('#createClaseModal h2').textContent = 'Editar Clase';

                // Cambiar el comportamiento del submit
                const form = document.getElementById('createClaseForm');
                form.dataset.editMode = 'true';
                form.dataset.classId = clase.id;

                // Cambiar texto del bot√≥n
                document.querySelector('#createClaseForm button[type="submit"]').textContent = 'Guardar Cambios';

                // Deshabilitar campo de tipo (no se puede cambiar al editar)
                document.getElementById('tipoPase').disabled = true;
                document.getElementById('nombreClase').disabled = true;
            } catch (error) {
                console.error('Error al editar clase:', error);
                showError('Error al cargar datos de la clase');
            }
        }
    </script>
</body>
</html>
